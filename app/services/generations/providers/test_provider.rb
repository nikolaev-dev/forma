module Generations
  module Providers
    # Test provider that returns placeholder images.
    # Used in development/testing when no real provider is configured.
    class TestProvider < ProviderInterface
      def create_generation(request)
        "test-#{SecureRandom.hex(8)}"
      end

      def get_status(_provider_job_id)
        "succeeded"
      end

      def fetch_result(_provider_job_id)
        {
          image_data: placeholder_image,
          content_type: "image/png",
          metadata: { provider: "test", generated_at: Time.current.iso8601 }
        }
      end

      def cancel(_provider_job_id)
        true
      end

      private

      def placeholder_image
        # 1x1 red PNG pixel as minimal placeholder
        [
          0x89, 0x50, 0x4E, 0x47, 0x0D, 0x0A, 0x1A, 0x0A, 0x00, 0x00,
          0x00, 0x0D, 0x49, 0x48, 0x44, 0x52, 0x00, 0x00, 0x00, 0x01,
          0x00, 0x00, 0x00, 0x01, 0x08, 0x02, 0x00, 0x00, 0x00, 0x90,
          0x77, 0x53, 0xDE, 0x00, 0x00, 0x00, 0x0C, 0x49, 0x44, 0x41,
          0x54, 0x08, 0xD7, 0x63, 0xF8, 0xCF, 0xC0, 0x00, 0x00, 0x00,
          0x03, 0x00, 0x01, 0x36, 0x28, 0x19, 0x00, 0x00, 0x00, 0x00,
          0x00, 0x49, 0x45, 0x4E, 0x44, 0xAE, 0x42, 0x60, 0x82
        ].pack("C*")
      end
    end
  end
end
