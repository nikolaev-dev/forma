<% content_for(:title) { "Дашборд — FORMA Admin" } %>

<div class="p-6">
  <h1 class="text-2xl font-bold mb-6">Дашборд</h1>

  <%# Stats cards %>
  <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
    <%= render "admin/dashboard/stat_card", label: "Заказы сегодня", value: @stats[:orders_today] %>
    <%= render "admin/dashboard/stat_card", label: "Оплачено", value: @stats[:orders_paid] %>
    <%= render "admin/dashboard/stat_card", label: "В производстве", value: @stats[:orders_in_production] %>
    <%= render "admin/dashboard/stat_card", label: "Генерации сегодня", value: @stats[:generations_today] %>
    <%= render "admin/dashboard/stat_card", label: "Стили", value: "#{@stats[:styles_published]}/#{@stats[:styles_count]}" %>
    <%= render "admin/dashboard/stat_card", label: "Теги", value: @stats[:tags_count] %>
    <%= render "admin/dashboard/stat_card", label: "Дизайны", value: @stats[:designs_count] %>
  </div>

  <div class="grid lg:grid-cols-2 gap-6">
    <%# Recent orders %>
    <div class="bg-white rounded-lg border border-gray-200 p-4">
      <h2 class="font-semibold mb-3">Последние заказы</h2>
      <% if @recent_orders.any? %>
        <table class="w-full text-sm">
          <thead><tr class="text-left text-gray-500 border-b">
            <th class="pb-2">Номер</th><th class="pb-2">Статус</th><th class="pb-2">Сумма</th>
          </tr></thead>
          <tbody>
            <% @recent_orders.each do |order| %>
              <tr class="border-b last:border-0">
                <td class="py-2"><%= link_to order.order_number, admin_order_path(order), class: "text-blue-600 hover:underline" %></td>
                <td class="py-2"><span class="px-2 py-0.5 rounded text-xs <%= order_status_class(order.status) %>"><%= order_status_label(order.status) %></span></td>
                <td class="py-2"><%= number_to_currency(order.total_cents / 100.0, unit: "\u20BD", format: "%n %u") %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      <% else %>
        <p class="text-gray-500 text-sm">Заказов пока нет</p>
      <% end %>
    </div>

    <%# Recent audit %>
    <div class="bg-white rounded-lg border border-gray-200 p-4">
      <h2 class="font-semibold mb-3">Последние действия</h2>
      <% if @recent_audit.any? %>
        <div class="space-y-2 text-sm">
          <% @recent_audit.each do |log| %>
            <div class="flex justify-between items-center py-1 border-b last:border-0">
              <div>
                <span class="font-medium"><%= log.actor_user&.name || log.actor_user&.email %></span>
                <span class="text-gray-500"><%= log.action %></span>
                <% if log.record_type %>
                  <span class="text-gray-400"><%= log.record_type %>#<%= log.record_id %></span>
                <% end %>
              </div>
              <span class="text-xs text-gray-400"><%= time_ago_in_words(log.created_at) %></span>
            </div>
          <% end %>
        </div>
      <% else %>
        <p class="text-gray-500 text-sm">Действий пока нет</p>
      <% end %>
    </div>
  </div>
</div>
