<%= form_with model: style, url: style.persisted? ? admin_style_path(style) : admin_styles_path,
              multipart: true,
              class: "bg-white rounded-lg border border-gray-200 p-4 space-y-4" do |f| %>
  <% if style.errors.any? %>
    <div class="p-3 bg-red-50 border border-red-200 rounded-lg text-sm text-red-700">
      <% style.errors.full_messages.each do |msg| %>
        <p><%= msg %></p>
      <% end %>
    </div>
  <% end %>

  <div class="grid grid-cols-2 gap-4">
    <div>
      <label class="block text-sm font-medium mb-1">Название</label>
      <%= f.text_field :name, class: "w-full px-3 py-2 border border-gray-300 rounded-lg text-sm", required: true %>
    </div>
    <div>
      <label class="block text-sm font-medium mb-1">Slug</label>
      <%= f.text_field :slug, class: "w-full px-3 py-2 border border-gray-300 rounded-lg text-sm", required: true %>
    </div>
  </div>

  <div>
    <label class="block text-sm font-medium mb-1">Описание</label>
    <%= f.text_area :description, rows: 2, class: "w-full px-3 py-2 border border-gray-300 rounded-lg text-sm resize-none" %>
  </div>

  <div class="grid grid-cols-3 gap-4">
    <div>
      <label class="block text-sm font-medium mb-1">Статус</label>
      <%= f.select :status, [["Draft", "draft"], ["Published", "published"], ["Hidden", "hidden"]],
          {},
          class: "w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" %>
    </div>
    <div>
      <label class="block text-sm font-medium mb-1">Позиция</label>
      <%= f.number_field :position, class: "w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" %>
    </div>
  </div>

  <%# Cover image %>
  <div>
    <label class="block text-sm font-medium mb-1">Обложка</label>
    <% if style.cover_image.attached? %>
      <div class="mb-2">
        <%= image_tag style.cover_image.variant(resize_to_fill: [120, 160]), class: "rounded-lg" %>
      </div>
    <% end %>
    <%= f.file_field :cover_image, accept: "image/*", class: "text-sm" %>
  </div>

  <%# Tags %>
  <div>
    <label class="block text-sm font-medium mb-2">Теги</label>
    <div class="flex flex-wrap gap-2 max-h-48 overflow-y-auto p-3 border border-gray-200 rounded-lg">
      <% tags.each do |tag| %>
        <label class="inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs border cursor-pointer
                      <%= selected_tag_ids.include?(tag.id) ? 'bg-gray-900 text-white border-gray-900' : 'bg-white text-gray-700 border-gray-300' %>">
          <input type="checkbox" name="tag_ids[]" value="<%= tag.id %>"
                 <%= 'checked' if selected_tag_ids.include?(tag.id) %>
                 class="hidden">
          <%= tag.name %>
        </label>
      <% end %>
    </div>
  </div>

  <%# Generation preset (JSON) %>
  <div>
    <label class="block text-sm font-medium mb-1">Пресет генерации (JSON)</label>
    <%= f.text_area :generation_preset,
        value: style.generation_preset.to_json,
        rows: 4,
        class: "w-full px-3 py-2 border border-gray-300 rounded-lg text-sm font-mono resize-none" %>
  </div>

  <div class="flex gap-2">
    <%= f.submit style.persisted? ? "Сохранить" : "Создать",
        class: "px-4 py-2 bg-gray-900 text-white text-sm rounded-lg cursor-pointer" %>
    <%= link_to "Отмена", admin_styles_path, class: "px-4 py-2 bg-gray-100 text-sm rounded-lg" %>
  </div>
<% end %>
