<% content_for(:title) { "Стили — FORMA Admin" } %>

<div class="p-6">
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-2xl font-bold">Стили (<%= @styles.size %>)</h1>
    <%= link_to "Создать стиль", new_admin_style_path, class: "px-4 py-2 bg-gray-900 text-white text-sm rounded-lg" %>
  </div>

  <%# Filters %>
  <%= form_with url: admin_styles_path, method: :get, class: "flex gap-3 mb-6 items-end" do |f| %>
    <div>
      <label class="block text-xs text-gray-500 mb-1">Статус</label>
      <%= f.select :status, [["Draft", "draft"], ["Published", "published"], ["Hidden", "hidden"]],
          { include_blank: "Все", selected: params[:status] },
          class: "px-3 py-1.5 border border-gray-300 rounded-lg text-sm" %>
    </div>
    <div>
      <%= f.text_field :q, value: params[:q], placeholder: "Поиск...",
          class: "px-3 py-1.5 border border-gray-300 rounded-lg text-sm" %>
    </div>
    <%= f.submit "Фильтр", class: "px-4 py-1.5 bg-gray-200 text-sm rounded-lg cursor-pointer" %>
  <% end %>

  <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
    <table class="w-full text-sm">
      <thead class="bg-gray-50">
        <tr>
          <th class="text-left px-4 py-3 font-medium text-gray-500">Поз.</th>
          <th class="text-left px-4 py-3 font-medium text-gray-500">Название</th>
          <th class="text-left px-4 py-3 font-medium text-gray-500">Slug</th>
          <th class="text-left px-4 py-3 font-medium text-gray-500">Статус</th>
          <th class="text-left px-4 py-3 font-medium text-gray-500">Теги</th>
          <th class="text-left px-4 py-3 font-medium text-gray-500">Поп.</th>
          <th class="text-right px-4 py-3 font-medium text-gray-500">Действия</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-100">
        <% @styles.each do |style| %>
          <tr>
            <td class="px-4 py-3 text-gray-500"><%= style.position %></td>
            <td class="px-4 py-3">
              <div class="flex items-center gap-2">
                <% if style.cover_image.attached? %>
                  <%= image_tag style.cover_image.variant(resize_to_fill: [32, 32]), class: "w-8 h-8 rounded object-cover" %>
                <% end %>
                <span class="font-medium"><%= style.name %></span>
              </div>
            </td>
            <td class="px-4 py-3 text-gray-500 font-mono text-xs"><%= style.slug %></td>
            <td class="px-4 py-3">
              <% css = case style.status; when "published" then "bg-green-100 text-green-700"; when "hidden" then "bg-gray-100 text-gray-600"; else "bg-yellow-100 text-yellow-700"; end %>
              <span class="px-2 py-0.5 rounded text-xs <%= css %>"><%= style.status %></span>
            </td>
            <td class="px-4 py-3 text-xs text-gray-500"><%= style.tags.limit(3).pluck(:name).join(", ") %></td>
            <td class="px-4 py-3"><%= style.popularity_score %></td>
            <td class="px-4 py-3 text-right space-x-2">
              <% if style.status != "published" %>
                <%= link_to "Опубл.", publish_admin_style_path(style), data: { turbo_method: :patch }, class: "text-green-600 hover:underline" %>
              <% end %>
              <% if style.status == "published" %>
                <%= link_to "Скрыть", hide_admin_style_path(style), data: { turbo_method: :patch }, class: "text-orange-600 hover:underline" %>
              <% end %>
              <%= link_to "Ред.", edit_admin_style_path(style), class: "text-blue-600 hover:underline" %>
              <% if style.status == "draft" %>
                <%= link_to "Удалить", admin_style_path(style), data: { turbo_method: :delete, turbo_confirm: "Удалить стиль?" }, class: "text-red-600 hover:underline" %>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
