<% content_for(:title) { "Аудит — FORMA Admin" } %>

<div class="p-6">
  <h1 class="text-2xl font-bold mb-6">Аудит-лог</h1>

  <%# Filters %>
  <%= form_with url: admin_audit_logs_path, method: :get, class: "flex gap-3 mb-6 items-end" do |f| %>
    <div>
      <label class="block text-xs text-gray-500 mb-1">Действие</label>
      <%= f.text_field :action_filter, value: params[:action_filter], placeholder: "tag.create...",
          class: "px-3 py-1.5 border border-gray-300 rounded-lg text-sm" %>
    </div>
    <div>
      <label class="block text-xs text-gray-500 mb-1">Тип записи</label>
      <%= f.text_field :record_type, value: params[:record_type], placeholder: "Tag, Style...",
          class: "px-3 py-1.5 border border-gray-300 rounded-lg text-sm" %>
    </div>
    <%= f.submit "Фильтр", class: "px-4 py-1.5 bg-gray-200 text-sm rounded-lg cursor-pointer" %>
  <% end %>

  <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
    <table class="w-full text-sm">
      <thead class="bg-gray-50">
        <tr>
          <th class="text-left px-4 py-3 font-medium text-gray-500">Дата</th>
          <th class="text-left px-4 py-3 font-medium text-gray-500">Пользователь</th>
          <th class="text-left px-4 py-3 font-medium text-gray-500">Действие</th>
          <th class="text-left px-4 py-3 font-medium text-gray-500">Запись</th>
          <th class="text-left px-4 py-3 font-medium text-gray-500">IP</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-100">
        <% @logs.each do |log| %>
          <tr>
            <td class="px-4 py-3 text-gray-500 text-xs"><%= log.created_at.strftime("%d.%m.%Y %H:%M:%S") %></td>
            <td class="px-4 py-3"><%= log.actor_user&.name || log.actor_user&.email %></td>
            <td class="px-4 py-3 font-mono text-xs"><%= log.action %></td>
            <td class="px-4 py-3 text-xs text-gray-500">
              <% if log.record_type %>
                <%= log.record_type %>#<%= log.record_id %>
              <% end %>
            </td>
            <td class="px-4 py-3 font-mono text-xs text-gray-400"><%= log.ip %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
