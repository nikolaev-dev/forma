<% content_for(:title) { "Генерация — FORMA" } %>

<div class="px-4 pt-12 flex flex-col items-center min-h-[70dvh] justify-center"
     data-controller="generation-progress"
     data-generation-progress-url-value="<%= api_generation_status_path(@generation.hashid) %>"
     data-generation-progress-result-url-value="<%= result_creation_path(@design) %>"
     data-generation-progress-interval-value="2000">

  <%# 3-шаговый индикатор %>
  <div class="flex items-center gap-2 mb-8">
    <% [ "Подготовка", "Генерация", "Готово" ].each_with_index do |label, i| %>
      <div class="flex items-center gap-2" data-generation-progress-target="step" data-step="<%= i + 1 %>">
        <div class="w-8 h-8 rounded-full flex items-center justify-center text-xs font-semibold border-2 transition-colors
                    <%= i == 0 ? 'border-forma-black bg-forma-black text-white' : 'border-forma-gray-300 text-forma-gray-400' %>"
             data-generation-progress-target="dot">
          <%= i + 1 %>
        </div>
        <span class="text-sm <%= i == 0 ? 'text-forma-black font-medium' : 'text-forma-gray-400' %>"
              data-generation-progress-target="label"><%= label %></span>
        <% if i < 2 %>
          <div class="w-6 h-px bg-forma-gray-200"></div>
        <% end %>
      </div>
    <% end %>
  </div>

  <%# Анимация ожидания %>
  <div class="w-16 h-16 mb-6" data-generation-progress-target="spinner">
    <svg class="animate-spin w-full h-full text-forma-gray-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"></circle>
      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
    </svg>
  </div>

  <p class="text-sm text-forma-gray-500" data-generation-progress-target="message">
    Создаём ваш дизайн...
  </p>

  <%# Сообщение об ошибке (скрыто) %>
  <div class="hidden mt-6 text-center" data-generation-progress-target="error">
    <p class="text-sm text-red-600 mb-4">Генерация не удалась</p>
    <a href="<%= new_creation_path %>" class="inline-block px-6 py-2.5 rounded-xl text-sm font-medium bg-forma-black text-white">
      Попробовать снова
    </a>
  </div>
</div>
