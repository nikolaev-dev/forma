1. Общая информация
   1.1. Название проекта

Конструктор блокнотов (Web / Mobile-first)

1.2. Цель

Сделать продукт, в котором пользователь:

выбирает стиль (быстро, “на входе”),

задаёт промпт / теги / слова,

получает 3 коротких превью (основное + 2 «мутации» с подкинутыми тегами),

докручивает результат (как “золото→серебро→tiffany”),

выбирает комплектацию и тариф (Base / Pro / Elite)

оплачивает через ЮKassa и оформляет заказ,

заказ маркируется штрихкодом и уходит в производство/исполнение.

1.3. Технологический стек (обязательный)

Backend: Ruby on Rails

DB: PostgreSQL

Очереди/джобы: Sidekiq + Redis (рекомендуется)

Хранилище файлов (превью, исходники, PDF): S3-compatible (Yandex Object Storage / MinIO / AWS S3)

Оплата: ЮKassa (webhooks)

Аутентификация: OAuth (VK, Яндекс, T-Bank, Альфа, Gmail (не РФ))

1.4. Формат интерфейса

Mobile-first (основной сценарий — телефон)

Desktop — адаптивный (не отдельное приложение)

2. Термины и сущности

Промпт — текстовое описание обложки/стиля.

Тег — элемент управляемого словаря (страна, сезон, стихия, бренд, архитектурный стиль…).

Скрытые теги — теги, которые используются системой для поиска/похожести/подбора, но не показываются пользователю (или показываются частично/как “подсказки”).

Стиль — карточка стиля в каталоге (пример + набор базовых тегов + пресет генерации).

Генерация — запуск пайплайна создания дизайна (превью/варианты).

Превью — быстрый “легкий” результат (картинка + мокап + краткое описание).

Вариант — одно из предложений по дизайну (включая “мутации”).

Ремикс — создание нового промпта/дизайна на базе чужого (fork) с сохранением происхождения.

Наполнение — тип внутреннего блока (клетка/линейка/точки/планер/датированный…).

Тариф — Base / Pro / Elite (разные цены, опции и/или материалы).

Кредиты генераций — лимиты/баланс/покупка доступа.

3. Роли и права доступа
   3.1. Роли

Гость

Пользователь (авторизован)

Создатель (то же что пользователь, но может публиковать промпты/шаблоны в каталог)

Модератор

Админ

3.2. Права (кратко)

Гость: просмотр каталога, ограниченное кол-во генераций, оформление заказа (по решению бизнеса: либо разрешить, либо только после авторизации).

Пользователь: генерации, докрутка, ремиксы, сохранение, заказ, оплата, история.

Создатель: публикация промптов/стилей (после модерации), статистика.

Модератор: очереди модерации контента, блокировки.

Админ: теги, стили, каталог, тарифы, лимиты, заказы, платежи, генерации, метрики.

4. Пользовательские сценарии (UX-флоу)
   4.1. Входной каталог стилей (обязательный)

Цель: максимально быстро “вытянуть” вкус пользователя.



Флоу:

Экран “Выбери, что нравится” — сетка карточек стилей (10–30 шт на старт).

Пользователь ставит лайк (и опционально дизлайк).

Система формирует профиль предпочтений (веса тегов/стилей).

Переход в “Создать блокнот” с предзаполненными стилевыми параметрами.

Требования:

Карточки: изображение, название стиля, 3–6 тегов (часть может быть скрыта).

Действия: лайк, пропустить, “ещё как это”.

На телефоне: свайп-карточки или сетка + быстрый лайк.

4.2. Создание блокнота (промпт + теги)

Поля:

Текстовый ввод: “Опиши блокнот” (промпт)

Теги (чипсы): добавление из подсказок

Быстрые пресеты (опционально): “страна”, “сезон”, “стихия”, “арх. стиль”, “палитра”

Кнопка: Сгенерировать

4.3. Результат генерации: 3 коротких превью (обязательный ключевой механизм)

После каждого “Сгенерировать” система показывает 3 карточки-превью:

Основной вариант — по промпту пользователя (по умолчанию в Pro).

Вариант A (мутация) — автоматически докручен: добавлено/заменено 1–2 тега.

Вариант B (мутация) — аналогично, другие 1–2 тега.

У каждой карточки:

картинка превью (и/или мокап блокнота),

краткая подпись “что изменили” (например: “Заменили золото → серебро”, “Добавили: tiffany mood”),

кнопки: Выбрать, Докрутить, Ремикс, Сохранить.

4.4. Докрутка (итеративный цикл)

Пользователь может:

нажать “Докрутить” → открыть экран изменения:

заменить теги (цвет/материал/стиль/бренд-настроение),

добавить новое требование текстом (“сделай больше минимализма”),

выбрать “усилить” параметр (ползунки: яркость/дороговизна/строгость/премиальность)

запустить повторную генерацию → снова получить 3 превью.

4.5. Ремиксы промптов (обязательный)

Любой опубликованный промпт/дизайн можно “взять и докрутить”.

При ремиксе сохраняется:

ссылка на исходник,

история изменений (минимум: “forked from …”, опционально — diff по тегам).

4.6. Выбор тарифа (Base / Pro / Elite) и оформление заказа

Тарифы и цены:

Base — 2599 ₽

Pro — 3199 ₽

Elite — 8999 ₽

Правило по умолчанию:

Генерация происходит в Pro.

Пользователь может дополнительно запросить Base и/или Elite для выбранного дизайна (кнопки “Сделать Base” / “Сделать Elite”).

Оформление:

Выбор “Наполнения” (внутреннего блока)

Формат (A5/B5/… — задаётся бизнесом)

Кол-во страниц (если параметризуется)

Доставка/получение (если нужно) + адрес + контакты

Оплата через ЮKassa

После оплаты: присвоение Order Number + генерация штрихкода

5. Функциональные требования
   5.1. Система тегов
   5.1.1. Типы тегов

Публичные: показываются пользователю как чипсы/фильтры.

Скрытые: используются системой для:

подбора “мутаций”

“похожих”

сортировки и поиска

автотегирования

внутренней аналитики

5.1.2. Категории тегов (минимум)

География: все страны мира (+ города опционально)

Времена года: весна/лето/осень/зима

Стихии: огонь/вода/земля/воздух (+ молния/лёд/… опционально)

Бренды одежды (как “настроение/эстетика”)*

IT/соцсети/продукты (как “настроение/эстетика”)*

Бренды lifestyle: икеа/старбакс и т.д.*

Стили мебели

Стили архитектуры

Палитры/цвета/материалы: золото/серебро/хром/медь, пастель, неон…

Типографика/настроение: “строго”, “люкс”, “минимализм”, “барокко”, “киберпанк”

*Важное требование по рискам: для бренд-тегов предусмотреть режим “brand mood” — вдохновение, без логотипов и прямого копирования (см. раздел 12 “Юридические и модерационные требования”).

5.1.3. Структура тегов

Тег имеет:

name

slug

category

visibility (public/hidden)

synonyms (синонимы и варианты написания)

parents/children (иерархия, опционально)

weights (вес для рекомендаций и мутаций)

banned (если запрещён)

Должны быть:

массовый импорт (CSV)

быстрый поиск по тегам

мердж дублей

5.1.4. “Скрытые теги” в выдаче

По умолчанию скрытые теги не показываются.

Но можно показывать пользователю “объяснение” мутаций:

“Мы добавили: …”

при этом можно показывать только безопасные/публичные аналоги.

5.2. Каталог стилей на входе
5.2.1. Карточка стиля

Содержит:

изображение-пример

название

короткое описание

набор базовых тегов (часть скрыта)

пресет генерации (параметры модели/шаблона)

популярность/рейтинг (если есть)

5.2.2. Механика “выбери, что нравится”

минимум 12 карточек на старт

после 5 лайков — можно предлагать “создать”

профиль предпочтений сохраняется в user_preferences

5.3. Поиск (теги, слова, промпты)
5.3.1. Виды поиска

По словам (full-text)

По тегам (faceted)

По промптам/похожести (опционально: семантический поиск)

5.3.2. Требования к поиску

Автодополнение

Фильтры:

стиль

категории тегов

тариф (если применимо)

популярное / новое

Сортировки:

популярность

рейтинг

новизна

“похоже на мой вкус”

5.4. “Популярное”

Лента популярных:

топ дизайнов

топ промптов

топ ремиксов

Учитывать:

просмотры

выбор/покупки

оценки (1–5)

сохранения

5.5. Генерация: Base / Pro / Elite
5.5.1. Цены

Base 2599 ₽

Pro 3199 ₽ (по умолчанию)

Elite 8999 ₽

5.5.2. Что означает “3 варианта”

Каждый блокнот должен существовать как минимум в 3 комплектациях:

base_version

pro_version

elite_version

Важно: различие может быть как:

по физическим параметрам (материалы, финиши, упаковка),

так и по “цифровому пакету” (качество, доп. варианты, ручная правка),

либо смешанно.

ТЗ фиксирует требование: у выбранного дизайна должна быть возможность выпустить три SKU (Base/Pro/Elite) и корректно считать цену, состав и производство.

5.6. “Мутации” (2 дополнительных превью при каждой генерации)
5.6.1. Правило

При каждом нажатии “Сгенерировать” система делает:

1 основной результат

+2 результата, в которые рандомно подбрасываются 2 тега (или 1–2 тега, если так лучше)

5.6.2. Алгоритм подбора тегов для мутаций (требование к логике)

Теги берутся из:

предпочтений пользователя (лайки стилей)

контекста промпта

глобальных трендов

“допустимых” категорий (например, не подбрасывать конфликтующие теги)

Должны быть ограничения:

не повторять те же теги, что уже есть

не подбрасывать запрещённые/рискованные

избегать бессмысленных сочетаний (правила совместимости)

5.6.3. UI

Каждая мутация показывает:

“Добавили: <тег1>, <тег2>” или “Заменили <A> на <B>”

кнопка “Принять изменения” (делает её новым основным вариантом)

5.7. Наполнение блокнота (внутренний блок)
5.7.1. Минимальный список наполнений

Клетка

Линейка

Точки (dot grid)

Пустые страницы

Трекер привычек (habit tracker)

Еженедельный планер (недатированный)

Ежедневник (недатированный)

Датированный (год/месяц/неделя/день) — если запускаете, обязательно указать год/локаль

5.7.2. Требования к наполнениям

Превью разворота

Настройки:

формат (A5 и т.п.)

поля

нумерация страниц (да/нет)

язык/локаль (ru по умолчанию)

Генерация PDF внутреннего блока (print-ready)

5.8. Заказ, оплата, штрихкод
5.8.1. ЮKassa

Оплата заказа через YooKassa Checkout

Получение статусов оплаты через webhooks:

pending → succeeded → canceled (минимум)

Хранить:

payment_id

статус

сумму

данные для бухгалтерии/чека (если включено)

5.8.2. Штрихкод

Каждый заказ получает:

order_number (человеческий)

barcode_value (строка)

barcode_type (Code128 рекомендовано для внутреннего учёта)

Штрихкод должен отображаться:

в админке

в карточке заказа

на печатной наклейке/листе комплектации (экспорт PDF)

5.8.3. Статусы заказа

draft (черновик)

awaiting_payment

paid

in_production

shipped (если есть доставка)

delivered

canceled/refunded

5.9. Лимиты и монетизация генераций
5.9.1. Лимиты

Гость: “чуть-чуть генераций” (например, 2–5 в сутки)

Авторизованный: “побольше” (например, 20–50 в сутки)

После исчерпания — предложение пополнить.

Лимит должен считаться:

по user_id (если есть)

по device/session (для гостя)

с антиабузом (IP + fingerprint мягко)

5.9.2. Пополнение

Требование пользователя:

“докинул 100 ₽ на генерации и генери сколько хочешь”.

Чтобы это было управляемо по себестоимости, фиксируем так:

Покупка “Безлимит генераций на N часов/сутки” за 100 ₽
(N задаётся бизнесом; рекомендовано 24 часа)

В безлимите сохраняются:

rate limit (например, не больше X генераций в минуту)

лимит параллельных задач (например, 1–2 одновременно)

Альтернатива (если решите иначе): 100 ₽ = пакет кредитов (например, 50 генераций).
Но в ТЗ закладываем именно “безлимит на период”, чтобы соответствовать формулировке “сколько хочешь”, и при этом иметь FUP.

6. Админка (ключевой блок “эволюционировать самому”)
   6.1. Управление тегами

Добавление/редактирование/удаление

Массовый импорт CSV

Синонимы и транслитерации

Категории

Видимость public/hidden

Веса и правила совместимости

Чёрный список

6.2. Управление каталогом стилей

CRUD стилей

Привязка тегов к стилю

Загрузка примеров

Порядок и блоки на главной

A/B-подборки (опционально)

6.3. “Режим куратора” (как вы описали)

Интерфейс, где админ:

запускает генерацию пачками (batch)

листает результаты

ставит оценку 1–5

нажимает “доп. генерация”

“добавь стиль” (создать новый стиль из удачного результата)

“отправить в каталог”

“пометить теги” (включая скрытые)

6.4. Заказы и производство

список заказов, фильтры по статусам

карточка заказа:

данные пользователя

выбранный дизайн/наполнение/тариф

файлы для печати (cover PDF, inner PDF)

штрихкод

история платежей и статусов

экспорт:

CSV заказов

PDF лист комплектации/наклейки со штрихкодом

6.5. Управление лимитами/тарифами

лимиты гостя/юзера

параметры “безлимита”

цены Base/Pro/Elite

промокоды (опционально)

7. Требования “очень удобно с телефона” (mobile UX)

Нижнее меню (пример):

Каталог

Создать

Поиск

Избранное

Профиль

Свайп-лайки на входном каталоге

Большие чипсы тегов (табы по категориям)

Генерация — с явным прогрессом:

статус (в очереди / генерирую / готово)

пуш/ин-апп уведомление (опционально)

Превью — в виде карточек 1x3 горизонтальным скроллом

“Докрутить” — быстрые кнопки-замены:

золото→серебро→хром

пастель→неон

строгий→люкс

PWA (опционально): “установить на экран”

8. Нефункциональные требования
   8.1. Производительность

Каталог и поиск должны работать < 500 мс на типовых запросах (серверная часть).

Превью должны грузиться прогрессивно (thumb → medium).

Генерации асинхронные (очередь).

8.2. Надёжность

Повторяемость джоб при сбое (retry)

Идемпотентные webhooks оплаты

Логи по генерациям и оплатам

8.3. Безопасность

OAuth только через проверенные стратегии

Защита от спама генераций (rate limit)

Хранение персональных данных с учётом требований РФ (если работаете в РФ)

9. Архитектура (предлагаемая)

Rails монолит:

Web UI (Hotwire/Turbo) или Rails + API + отдельный фронт (по решению)

PostgreSQL:

основная схема + full-text индекс

Redis:

Sidekiq + rate limiting

Object Storage:

превью, мокапы, PDF, исходники

Генераторный сервис:

может быть встроен как адаптер (обёртка) к выбранной модели/провайдеру

обязательно: абстракция “provider” (чтобы можно было менять)

10. Модель данных (минимальный ER-скелет)
    10.1. Таблицы (предложение)

users

oauth_identities (provider, uid, tokens)

user_preferences (веса тегов/стилей)

styles

style_examples

tags

tag_relations (parent-child, совместимости)

prompts

prompt_versions (для ремиксов)

notebook_designs (логическая сущность дизайна)

generations (запуски)

previews (3 превью на генерацию)

ratings (1–5)

favorites

orders

order_items (если в заказе может быть >1)

payments (YooKassa)

generation_passes или credits (лимиты/безлимит)

admin_actions (аудит)

10.2. Связи (кратко)

user has_many prompts, notebook_designs, orders

notebook_design has_many generations

generation has_many previews (ровно 3 на MVP)

tags many-to-many: prompts, styles, notebook_designs (через join-таблицы)

orders belong_to user, belong_to notebook_design_version (base/pro/elite)

11. API/эндпойнты (если делаете JSON API) — минимум

POST /generations — создать генерацию

GET /generations/:id — статус

GET /generations/:id/previews — 3 превью

POST /previews/:id/remix — ремикс

POST /orders — создать заказ

POST /payments/yookassa/webhook — вебхук

GET /catalog/styles

GET /search?q=...&tags[]=...

Если UI сервер-сайд (Rails views + Turbo) — всё равно держать сервисный слой, чтобы позже не ломаться.

12. Модерация и юридические ограничения (важно из-за “брендов”)

Так как вы хотите теги “все бренды одежды/IT/ikea/starbucks”, нужно заложить правило:

Бренд-теги = “настроение/эстетика”, а не логотип/товарный знак.

Запрет на генерацию:

логотипов

точных копий фирменных персонажей/маскотов

прямых упаковок/этикеток

Требования в продукт:

фильтр промптов (словарь запрещённых слов + модерация)

флаг “requires_review” для спорных случаев

кнопка “пожаловаться”

13. Приёмка (Definition of Done / критерии)
    MVP считается готовым, если:

Есть входной каталог стилей с лайками и переходом в генерацию.

Есть генерация, которая каждый раз отдаёт 3 превью: основной + 2 мутации с тегами.

Есть докрутка и итерации.

Есть поиск по словам и тегам.

Есть “популярное”.

Есть ремиксы промптов.

Есть выбор наполнения (минимум 4 типа).

Есть заказ + оплата ЮKassa + вебхуки.

У заказа есть штрихкод и статусы.

Есть админка: теги, стили, генерации, оценки 1–5, заказы.

14. Предложение по этапам (чтобы не утонуть)
    Этап 1 (MVP)

каталог стилей + лайки

теги (public/hidden) + импорт

генерация + 3 превью + мутации

докрутка

поиск

заказы + ЮKassa + штрихкод

базовая админка

Этап 2

расширение наполнений (датированный планер)

семантический поиск (по похожести промптов)

“создатели”, публичные коллекции

улучшенная модерация и антиабуз

Этап 3

персонализация ленты “популярное для вас”

A/B тесты входного каталога

расширение тарифов (настоящие различия Base/Pro/Elite в производстве)

Что я “зафиксировал как решения” (чтобы ТЗ было применимо сразу)

Генерация по умолчанию Pro, Base/Elite — по запросу пользователя.

Каждый запуск выдаёт 3 превью, 2 из которых — мутации с подброшенными тегами + понятное объяснение “что поменяли”.

Лимиты: гости мало, авторизованные больше, за 100 ₽ — безлимит на период (с rate limit), чтобы было честно “сколько хочешь”, но без риска убить себестоимость.

Админке уделено столько же внимания, сколько пользовательской части (иначе вы не сможете “эволюционировать”).

Если хочешь, я могу дополнить ТЗ двумя максимально практичными вещами (без вопросов и согласований, просто как “приложения”):

Макеты экранов (wireflow) в текстовом виде: какие экраны и какие элементы на каждом, прям по мобильному UX.

Подробную спецификацию базы (поля таблиц) + события/состояния генераций/оплат/заказов (state machine), чтобы разработчик мог сразу заводить миграции и модели.

а теперь подумай еще над тем, как это станет таким же брендом на рынке блокнотов как moleskine когда-то

и придумай еще бренд и стратегию
Thought for 6m 42s

Нужно сделать так, чтобы вы были не “сервис печати кастома”, а культурный объект и символ — как когда‑то Moleskine стал символом “я человек с идеями”. У Moleskine было несколько сильных рычагов, которые можно переосмыслить под вашу модель “генерация → докрутка → покупка”.



Ниже — как вырасти в бренд уровня Moleskine + вариант бренда и стратегия, заточенные под вашу механику (теги, ремиксы, 3 превью, Base/Pro/Elite, мобильность).

1) Что сделало Moleskine брендом (и что вам нужно повторить, но по‑своему)
1) Иконический продуктовый “код”

У Moleskine были узнаваемые детали: форма, резинка, закругления, лента, карман, бумага. Даже издалека понятно “это оно”.



Вам нужен такой же код, иначе вы будете “ещё один кастом‑принт”.



Пример вашего кода (желательно 4–6 элементов, всегда одинаковых):

фирменная плашка на корешке (как “паспорт” дизайна)

внутренняя первая страница‑манифест (“Designed by you, curated by …”)

карман + карточка “Design DNA” (о ней ниже)

одна фирменная деталь на обложке (например, тонкая рамка/микротиснение/паттерн)

тактильная бумага (важнее, чем кажется): люди запоминают рукой

2) Миф/история вместо “функции”

Moleskine продавал не блокнот, а “я принадлежу к миру творцов”.



Ваша история должна быть не про AI, а про человека:

“Ты не покупаешь блокнот. Ты фиксируешь свою вселенную. И она становится физической.”

3) Курация (редакция) вместо хаоса кастома

Кастом обычно выглядит дешево, потому что всё можно.
Бренд — это ограничения и вкус.



У вас курация встроена идеально: каталог стилей, скрытые теги, “мутации”, рейтинг 1–5 в админке.

4) Сообщество, ритуалы, коллекционирование

Moleskine коллекционировали, дарили, носили как аксессуар.
Вам нужен социальный цикл: сгенерил → показал → ремикснули → стало трендом → купили → коллекция.

2) Ваше “бренд‑ядро”: позиционирование, которое реально может стать культовым
   Позиционирование

“Первый блокнот, который рождается из твоего вкуса — и выглядит как премиальный бренд, а не как кастомная печать.”

Обещание бренда

Быстро создать дизайн (мобильно)

Докрутить как в разговоре (“золото → серебро → tiffany”)

Получить вещь, которую хочется носить, а не просто распечатку

Три слова‑столпа

Вкус (курация)

Ритуал (ежедневное использование)

Коллекция (хочется собрать несколько)

3) Предлагаю бренд: FOLIO (или FOLIO Atelier) — и стратегия
   Почему FOLIO

международно читается

ассоциация с листом, коллекцией, портфолио, “страницей жизни”

легко строить линейку: Folio Base / Folio Pro / Folio Elite

подходит и для “каталога стилей”, и для “редакции”

Важно: перед запуском надо проверить доступность товарного знака и домена, но концептуально имя сильное.

Слоган (варианты)

“Твой мир — на обложке.”

“Сделай идею физической.”

“Notebook as identity.” (для англ. материалов)

Тон бренда

Не “технологичный”, а “редакционный”: как журнал/издательство.

спокойный, умный

короткие формулировки

ощущение вкуса и статуса без пафоса

4) “Фишка уровня легенды”: Design DNA + коллекционные издания

Вот что может стать вашим аналогом “резинки и легенды” — то, что люди будут узнавать и хотеть.

4.1. Design DNA Card (в каждом блокноте)

В кармане внутри лежит карточка:

название дизайна

“создано из”: 3–6 ключевых тегов (часть можно шифровать или делать красивыми метками)

дата создания

ID / штрихкод

QR (ведёт на страницу дизайна: история, ремиксы, “создать похожий”)

Это даёт:

чувство “у вещи есть происхождение”

коллекционность

вирусность (люди сканируют, делятся)

4.2. “Drops” (лимитированные дропы)

Раз в месяц:

дроп из 10–20 отобранных дизайнов (вы куратор)

каждый — лимит (например, 300 шт)

нумерация “Edition 043/300”

отдельная упаковка и страница

Это резко повышает “брендовую температуру”:
люди покупают не только “мне нужно”, а “я хочу успеть”.

5) Продуктовая стратегия: как сделать Base/Pro/Elite частью бренда, а не просто ценниками

Если Base/Pro/Elite отличаются только “цифрой”, бренд не растёт. Разница должна быть физической и ощущаемой.

Base — 2599 ₽

“Everyday”: доступный вход в бренд

мягкая обложка

стандартная бумага, но приятная (не офисная)

1 лента / без кармана (или карман проще)

без спец‑финишей (тиснение/фольга)

Pro — 3199 ₽ (по умолчанию)

“Signature”: ваша главная модель (как Moleskine classic)

фирменный тактильный материал обложки

карман + Design DNA card

2 ленты или лента + резинка

улучшенная бумага (чтобы ручка ложилась вкусно)

аккуратная типографика внутри

Elite — 8999 ₽

“Collector / Atelier”: вещь‑подарок

твёрдая обложка + премиальная отделка (тиснение, фольга, фактура)

коробка/суперобложка

персональная табличка “Edition”

доп. вариант обложки в комплекте (или “второй сменный арт‑лист”)

возможно: “подтверждение куратора” (выбор лучших)

Главное: Elite должен ощущаться как предмет, который дарят.

6) Маркетинговая стратегия: как стать “брендом‑символом”, а не “сервисом”
   6.1. Главный контент‑хук (под TikTok/Reels)

У вас встроен идеальный формат:

“до” (превью)

“а теперь поменяй золото на серебро”

“а теперь tiffany”

“вот 3 варианта, выбери”

“через 5 дней это приехало на стол”

Это готовый сериал. 100 роликов можно снять без бюджета.

6.2. Воронка бренда (очень простая)

Пользователь видит ролик “докрутка”

Жмёт → попадает в входной каталог стилей (лайки)

Генерит → получает 3 превью

Делится превью (кнопка Share обязана быть топ‑кнопкой)

Друзья ремиксят → это уже их дизайн

Кто‑то заказывает → появляется “популярное”

“Популярное” снова кормит входной каталог

Это “UGC‑машина”, но только если:

превью красивые

share — в один тап

на share‑картинке есть маленький аккуратный watermark бренда

6.3. “Creators Program” (необязательно сразу, но это путь к масштабу)

Сделайте роль “Создатель” не формально, а как статус:

создатели публикуют стили/промпты

вы отбираете в “Editorial”

лучшие попадают в дропы

создатели получают % (или бонусы)

Это создаёт рынок вкуса, а не просто “генератор”.

7) Дистрибуция: где рождаются блокнот‑бренды

Чтобы стать “как Moleskine”, вам нужны места, где люди уже в правильном настроении.

Каналы 1-й очереди

D2C сайт (основа)

pop‑up стойки: книжные, концепт‑сторы, ярмарки, дизайн‑маркеты

кофейни/коворкинги (не надо бренд‑коллабов, просто точки продаж)

дизайн‑школы/университеты: “коллекции выпускников”

B2B подарки: компании любят персонализацию, но вы продаёте “брендовый предмет”

8) Бренд‑правила (чтобы не стать “дешёвым кастомом”)
   8.1. Курация важнее свободы

Даже если пользователь может всё — интерфейс должен вести через “вкусные рельсы”:

входной каталог

аккуратные теги

мутации не случайные, а “умно‑красивые”

“редакционный отбор” в популярном

8.2. Ограничьте “плохие комбинации”

Ваша админка с оценкой 1–5 — суперсила.
Сделайте так, чтобы:

мусорные комбинации не выходили на витрину

витрина всегда выглядит как бренд

8.3. “Бренды как настроение”, без логотипов

Иначе вы будете постоянно в юридических проблемах и потеряете премиальность.
Дайте людям кнопки:

“ikea mood” (сканди‑минимализм)

“starbucks mood” (уют/кофе/тепло)

“tiffany mood” (фирменная палитра‑настроение без копирования)

9) План запуска (коротко, но по‑взрослому)
   Месяц 1: “Редакция вкуса”

30–50 эталонных стилей в каталоге

200–500 отобранных дизайнов (вы через админку отбраковали)

включить “популярное” и “ремиксы”

сделать 20–30 коротких роликов “докрутка”

Месяц 2: “Дроп №1”

лимитированный дроп (10–20 дизайнов)

Edition numbering + Design DNA card

поп‑ап (если возможно) или онлайн‑ивент

Месяц 3: “Creators”

набор 30 создателей (дизайнеры, иллюстраторы, блогеры про планирование)

конкурс/челлендж “обложка месяца”

лучшие — в дроп №2

10) Ещё 5 вариантов названия (на случай, если FOLIO занято)

(Все требуют проверки ТЗ/доменов, но концептуально подходят)

ATELIER NOTE — “мастерская блокнотов”

SCRIPTUM — более “литературно”

FORMA — про форму, вкус, дизайн

PAGECRAFT — ремесло страницы (англ.)

MONOBOOK — минималистично, хорошо ложится на премиум

11) Если совсем по‑честному: ваш главный moat (защита) — это не AI

Ваш moat — это:

граф тегов (скрытые теги + совместимости)

редакция и вкус (админ‑куратор + рейтинги)

социальная механика ремиксов

узнаваемый продуктовый код

качество физики (бумага/переплёт/ощущение)

Если вы удержите эти 5 вещей — вы реально можете стать “тем самым” брендом.

Если хочешь — я прямо следующим сообщением оформлю это как:

Brand book v0.1 (миссия, архетип, визуальные принципы, голос, упаковка, обязательные элементы продукта)

Go-to-market план на 90 дней с метриками (share rate, conversion generation→order, repeat rate)
без дополнительных вопросов, на основе того, что уже есть.

Исправь теперь ТЗ исходя из того, что ты написал

Отдельно сделай визуальную часть для клиента
Админку управления стилями/каталога
Админку управления заказами
Интеграцию с нейросетями генерации изображений

Я выбираю FORMA
Thought for 5m 2s

Ниже — обновлённое ТЗ v2 с учётом бренд‑стратегии (редакция/курация, “продуктовый код”, коллекционность, Design DNA, дропы, “brand mood” вместо логотипов) и с разнесением на отдельные блоки:

Визуальная часть для клиента (mobile‑first UI/UX)

Админка управления стилями/каталогом

Админка управления заказами

Интеграция с нейросетями генерации изображений

Бренд проекта фиксируем: FORMA.

ТЗ v2 — FORMA (Конструктор блокнотов с курацией и генерацией)
0. Краткое описание продукта

FORMA — сервис, где пользователь быстро выбирает вкус через каталог стилей, генерирует дизайн обложки, докручивает его через теги/промпт (в стиле “золото → серебро → tiffany mood”), получает 3 коротких превью на каждый шаг (1 основной + 2 “мутации”), а затем заказывает блокнот в комплектациях Base / Pro / Elite с оплатой через ЮKassa. Каждый заказ получает штрихкод и печатные файлы для производства.

1. Цели и принципы бренда FORMA (как “бренд уровня Moleskine”, но по‑своему)
   1.1. Ключевая идея бренда

FORMA — не “печать кастома”, а редакция вкуса + ритуал + коллекционирование:

Редакция: каталог стилей, скрытые теги, курация результатов (в т.ч. админ‑оценки 1–5)

Ритуал: удобство ежедневного использования (наполнения, качество бумаги, понятная линейка)

Коллекция: “Edition”, “Drops”, карточка “DNA”, QR‑история дизайна, ремиксы

1.2. Продуктовый код FORMA (обязательные “узнаваемые элементы”)

В каждом блокноте FORMA (минимум Pro/Elite, опционально Base) должны быть:

FORMA DNA Card (карточка происхождения дизайна) — в кармане или вклейке

Страница‑манифест (первая страница): “Designed by you. Curated by FORMA.” (локализуемо)

Фирменная метка на корешке/внутри (микроплашка/штамп/типографический знак)

QR‑код на страницу дизайна (просмотр, ремиксы, “создать похожий”)

Для Elite: Edition numbering (например, 043/300 для дропа)

Примечание: физические детали (резинка/лента/карман/упаковка) — задаются как параметры SKU в админке, но “DNA/QR/манифест” — часть бренд‑ядра.

2. Технологический стек (фиксировано)

Backend: Ruby on Rails

DB: PostgreSQL

Очереди: Sidekiq + Redis

Хранилище: S3‑compatible (Yandex Object Storage / MinIO / AWS S3)

Оплата: ЮKassa (webhooks)

Авторизация: OAuth/OpenID (VK, Яндекс, T‑ID/T‑Bank, Alfa ID/Альфа, Gmail (не РФ))

Генерация изображений: через абстракцию провайдеров (см. раздел 8)

3. Роли и доступ

Гость: просмотр, ограниченные генерации, шаринг превью

Пользователь: генерации, докрутка, ремиксы, сохранения, заказ/оплата, история

Создатель (фаза 2): публикация промптов/стилей в каталог (через модерацию)

Модератор: очереди модерации, блокировки

Админ: теги, стили, каталог, дропы, генерации, заказы, оплаты, лимиты, настройки

4. Функциональные требования (ядро продукта)
   4.1. Каталог стилей “на входе” (обязательный)

Экран выбора вкуса: сетка/свайп карточек стилей

Пользователь отмечает “нравится” (лайк) → формируется профиль предпочтений

Переход к созданию: промпт уже “подогрет” стилем (пресет)

4.2. Теги (публичные и скрытые)

Теги по категориям (страны мира, сезоны, стихии, мебельные стили, архитектурные стили, палитры, материалы, настроения)

Поддержка скрытых тегов для:

мутаций превью

поиска “похожего”

персонализации витрин

Теги‑бренды: только в формате brand mood (без логотипов/копирования)

4.3. Поиск

По словам (full‑text)

По тегам (фасетный)

По промптам/похожести (опционально: семантический поиск, фаза 2)

4.4. Генерация + докрутка (главная механика)

Каждый запуск “Сгенерировать” выдаёт 3 превью:

Основное (по промпту пользователя + профиль вкуса)

Мутация A: +1–2 тега (или замена тега) из допустимых

Мутация B: другая комбинация

На каждом превью:

картинка + мокап

“что изменили” (читаемо)

действия: Выбрать / Докрутить / Сохранить / Ремикс

Докрутка:

добавление/удаление тегов

быстрые замены (например: золото→серебро→хром)

текстовая правка промпта

повторная генерация → снова 3 превью

4.5. Ремиксы (обязательный)

Любой публичный дизайн/промпт можно “взять и докрутить”

Сохраняется родословная (fork‑связь)

На странице дизайна показываются ремиксы

4.6. Комплектации и цены

FORMA Base — 2599 ₽

FORMA Pro — 3199 ₽ (по умолчанию генерируем в Pro)

FORMA Elite — 8999 ₽

Требование:

Любой выбранный дизайн можно оформить как Base/Pro/Elite SKU

Для Elite предусмотрены дополнительные атрибуты (упаковка, edition numbering, премиальные финиши — управляется админкой)

4.7. Наполнения (внутренний блок)

Минимум в MVP:

клетка

линейка

dot grid

пустые

(плюс 1–2 планера: недельный/ежедневный недатированный — по приоритету)

Требования:

превью разворота

генерация печатного PDF внутреннего блока (print‑ready)

настройки: нумерация страниц, язык, поля

4.8. Заказ, оплата, штрихкод

ЮKassa: создание платежа, обработка webhook статусов

После оплаты: формируется заказ и присваивается штрихкод (Code128) + order number

Статусы: draft → awaiting_payment → paid → in_production → shipped → delivered → canceled/refunded

4.9. Лимиты и монетизация генераций

Гость: “чуть‑чуть” генераций (настраиваемо)

Авторизованный: “побольше” (настраиваемо)

Пополнение: 100 ₽ = безлимит генераций на период (по умолчанию 24 часа) + Fair Use (rate limit и лимит параллельных задач)

5. Визуальная часть для клиента (UI/UX, mobile‑first) — отдельный блок
   5.1. Принципы интерфейса FORMA

“Редакционный минимализм”: мало шума, много воздуха, крупная типографика

1 главный CTA на экран

Превью — всегда “красиво” (мокап + аккуратная подпись)

В один тап: Share, Докрутить, Заказать

5.2. Основные пользовательские экраны (MVP)
A) Онбординг вкуса: “Выбери, что нравится”

Карточки стилей (свайп или сетка)

Кнопки: ❤️ / Пропустить

Индикатор прогресса (например, “выбрано 3/5”)

CTA: “Перейти к созданию”

B) Главная

Блок “Продолжить” (последние дизайны)

“Популярное сегодня”

“Дроп/Редакция” (если включено)

Поиск

C) Создание дизайна

Поле промпта (1–2 строки + expand)

Чипсы тегов (по категориям)

Быстрые пресеты (страна/сезон/стихия/архитектура/материал)

CTA: “Сгенерировать (Pro)”

D) Экран результата генерации (ключевой)

Горизонтальная лента из 3 карточек:

Основное

Мутация A

Мутация B

На карточке:

превью‑мокап

“что изменили”

кнопки: Выбрать / Докрутить

Внизу: “Сохранить”, “Поделиться”, “Ремикс”

E) Докрутка

Блок “замены в один тап” (золото→серебро→хром, пастель→неон…)

Теги по категориям (табами)

Поле “добавь словами”

CTA: “Обновить (3 превью)”

F) Карточка дизайна (публичная страница)

Большое превью + галерея

Теги (публичные)

Кнопки: “Ремикс”, “Сделать похожий”, “Заказать”

Блок ремиксов

Блок “Похожие по вкусу”

G) Выбор наполнения

Список наполнений с мини‑превью разворота

Настройки (нумерация, язык, формат если нужен)

CTA: “Дальше”

H) Выбор комплектации Base/Pro/Elite

3 карточки с ценой и краткими отличиями

По умолчанию выделен Pro

CTA: “Оформить заказ”

I) Оформление и оплата

Контакты, доставка/самовывоз (если есть)

Итоговая сумма

“Оплатить ЮKassa”

После оплаты: экран “Заказ принят” + QR/номер

J) Профиль

История дизайнов

История заказов

Лимиты/безлимит

Избранное

5.3. Визуальные артефакты (что должны отрисовать дизайнеры)

UI‑kit: кнопки, чипсы тегов, карточки стилей, карточка превью, карточка тарифа

Мокап‑шаблоны: 2–3 ракурса блокнота (для превью)

Шаблон “FORMA DNA Card” (печать/цифра)

Шаблон “страница‑манифест”

Водяной знак для share‑картинок (минимальный, не портит)

5.4. Share‑механика (обязательная для роста бренда)

Генерировать “share‑картинку”:

превью + название дизайна + маленький знак FORMA

короткий URL на страницу дизайна

Share в 1 тап (iOS/Android системный шаринг)

6. Админка управления стилями/каталогом — отдельный блок
   6.1. Разделы админки “Каталог”

Теги

Стили

Подборки / Витрины

Редакция / Курация

Дропы (Drops) / Edition (можно включить в MVP минимально или как фаза 2)

6.2. Управление тегами

Функции:

CRUD тегов

категории тегов

public/hidden

синонимы/варианты написания

веса (для рекомендаций/мутаций)

правила совместимости (нельзя/нежелательно вместе)

массовый импорт CSV

мердж дублей

стоп‑листы и “brand mood” флаги

6.3. Управление стилями

Карточка стиля:

название, описание

1–5 изображений‑примеров

набор тегов (включая скрытые)

пресет генерации (параметры провайдера/модели/пост‑обработки)

статус: черновик / опубликован / скрыт

позиция/приоритет в каталоге

метрики (просмотры/лайки/заказы)

6.4. Витрины/подборки

“Популярное”, “Редакция”, “Новые”, “Для тебя”

ручная фиксация карточек в топ

расписание публикаций (опционально)

6.5. Режим “Куратор” (как вы хотели)

Экран потока генераций:

запуск batch‑генераций по стилю/набору тегов

просмотр результатов

оценка 1–5

“доделать” (перегенерировать)

“создать стиль из результата”

“добавить в каталог”

быстрый редактор тегов результата (в т.ч. скрытых)

6.6. Управление “DNA Card” и манифестом

шаблоны текста манифеста (локали)

формат DNA‑карты (какие поля печатать, где QR, где ID)

6.7. Дропы (Drops) / Edition numbering

создание дропа: название, период, лимит тиража

набор дизайнов в дроп

автонумерация (043/300)

отдельная витрина дропа на клиенте

правила продаж (доступно/распродано)

7. Админка управления заказами — отдельный блок
   7.1. Список заказов

Фильтры:

статус

дата

тариф Base/Pro/Elite

дроп/обычный

способ доставки

оплачен/не оплачен

поиск по номеру/почте/телефону

В таблице:

номер заказа

клиент

сумма

статус

дата

кнопка “Открыть”

7.2. Карточка заказа

Обязательные блоки:

данные клиента

состав заказа:

дизайн (ссылка на страницу дизайна)

комплектация (Base/Pro/Elite)

наполнение (тип + параметры)

формат/страницы (если применимо)

штрихкод (визуально + значение)

статусы производства (timeline)

файлы производства:

обложка (print PDF)

внутренний блок (print PDF)

превью/мокап (для сверки)

DNA Card (PDF/PNG)

платежи:

payment_id YooKassa

статус

суммы

возвраты (если будут)

7.3. Производство и логистика

кнопки смены статуса (paid → in_production → shipped → delivered)

поле “трек‑номер” (если доставка)

экспорт:

CSV

PDF лист комплектации

PDF с наклейками штрихкодов (пакетная печать)

7.4. Возвраты/отмена

сценарий отмены (до производства/после)

интеграция возврата через YooKassa (если включаете)

журнал действий админов (audit log)

8. Интеграция с нейросетями генерации изображений — отдельный блок
   8.1. Требования к интеграции (ключевые)

Поставщик(и) генерации подключаются через единый интерфейс провайдера (чтобы менять/добавлять без переписывания продукта).

Генерация всегда асинхронная (Sidekiq), UI получает статусы.

На каждый запуск выдаём ровно 3 превью (main + mutation A + mutation B).

Поддерживаем “стабильность стиля” (чтобы докрутка сохраняла узнаваемость дизайна).

Встроенная модерация промптов/результатов (блок/флаг на проверку).

8.2. Абстракция провайдера (Provider Interface)

Каждый провайдер обязан реализовать:

create_generation(request) → возвращает provider_job_id

get_status(provider_job_id) → pending/running/succeeded/failed

fetch_result(provider_job_id) → ссылки/байты изображений + метаданные

cancel(provider_job_id) (опционально)

В запросе:

исходный промпт

нормализованные теги (public/hidden)

пресет стиля

seed/вариативность

параметры качества (preview/high-res)

запрет логотипов/брендов (policy flags)

8.3. Сборка промпта (Prompt Composer)

Сервис, который формирует финальный промпт из:

текста пользователя

выбранного стиля (его “тон/эстетика”)

тегов

скрытых тегов (аккуратно)

системных ограничений (без логотипов, без копирования)

Принцип: бренд‑теги как mood, а не как “нарисуй логотип”.

8.4. Мутации (Tag Mutation Engine)

Сервис, который:

выбирает 1–2 тега для добавления/замены

учитывает:

предпочтения пользователя

совместимость тегов

тренды (позже)

запреты

генерирует объяснение изменения (“заменили X на Y”, “добавили A,B”)

8.5. Пайплайн генерации (MVP)

На 1 действие “Сгенерировать”:

Создать сущность Generation

Сформировать 3 “PromptVariant”:

Main

MutA

MutB

Отправить 3 задачи провайдеру (параллельно или с лимитами)

Получить результаты → сохранить изображения в Object Storage

Сгенерировать мокап(ы) блокнота (пост‑процесс)

Отдать клиенту 3 карточки превью

8.6. Качества и форматы изображений

Минимальные производственные форматы:

thumb (быстро грузится)

preview (для выбора)

hires (для печатного макета обложки)

Печать:

итоговый файл обложки — print‑ready PDF (параметры формата/bleed/поля — конфигурируемые в админке)

внутренний блок — print‑ready PDF

Важно: конвертация в CMYK и профили — отдельная настройка производства. В MVP можно стартовать с RGB→PDF, но в ТЗ заложить возможность профилей в будущем.

8.7. Ограничения и модерация

фильтр промптов и тегов (запрещённые слова/темы)

флаг “requires_review”

запрет генерации логотипов и копирования

кнопка “пожаловаться” на публичной странице дизайна

8.8. Логи и наблюдаемость

лог каждого запуска:

финальный промпт (с маскированием чувствительных частей)

теги/мутации

провайдер, модель, время

стоимость/квота (если учитываете)

метрики:

time-to-preview

conversion: generation→select→order

share rate

repeat generation rate

9. Архитектура и сущности данных (кратко)
   9.1. Основные сущности

Users, OAuth identities

Tags (+ категории, hidden/public, synonyms, rules)

Styles (+ пресеты)

Prompts / Designs (дизайн как сущность)

Generations (запуски)

Previews (3 карточки на запуск)

Ratings (1–5, включая админ‑оценки)

Orders, Payments, Barcodes

Fillings (наполнения, параметры)

Drops/Editions (опционально MVP, точно фаза 2)

Audit log (действия админов)

9.2. Поиск

PostgreSQL full‑text + trigram для быстрых подсказок

(Фаза 2) векторный поиск по промптам/тегам

10. Критерии приёмки (MVP)

MVP принят, если:

Есть входной каталог стилей + лайки → влияет на предложения.

Есть создание промпта + теги.

Каждая генерация возвращает 3 превью: основное + 2 мутации с объяснением.

Есть докрутка и повторные итерации.

Есть поиск по словам и тегам.

Есть “Популярное”.

Есть ремиксы (fork).

Есть наполнения (минимум 4) + PDF внутреннего блока.

Есть Base/Pro/Elite, по умолчанию Pro.

Есть заказ + ЮKassa + webhooks + штрихкод.

Есть админка:

теги/стили/каталог

кураторский режим (оценка 1–5, batch)

заказы (статусы, файлы, экспорт)

11. Рекомендованный план релиза (чтобы бренд сразу “звучал”)

Сразу в MVP заложить бренд‑ядро:

DNA Card + QR на страницу дизайна (хотя бы цифровую)

аккуратный watermark на share‑картинках

“Редакция FORMA” как витрина из отобранных (админ‑оценка ≥4)

Drops/Editions можно включить как “минимальную версию”:

коллекция недели (без лимита тиража) → затем превратить в лимитированные дропы

Если хочешь, я могу в следующем сообщении (без дополнительных вопросов) добавить приложения к ТЗ:

A) детальные wireframes‑описания по каждому экрану (по блокам, с точными CTA и состояниями загрузки)

B) список таблиц/полей (schema draft) под Rails migrations

C) описание state machine для Generation/Order/Payment (с переходами и ограничениями)

Начни с шага А
Пользовательского интерфейса
Reasoned for 4m 7s

Ниже — Приложение A к ТЗ (FORMA): подробная спецификация пользовательского интерфейса (mobile‑first) в формате wireframe‑описания: экраны, блоки, CTA, состояния загрузки/ошибок, тексты, и логика переходов.

Приложение A — Пользовательский интерфейс FORMA (Mobile‑first, v0.1)
A0. Общие принципы UI FORMA

Цель: ощущение “редакционного премиума”, а не “кастом‑печати”.

Один главный CTA на экран (кроме экранов выбора).

Крупная типографика, много воздуха.

Чипсы тегов — большие, удобно нажимать большим пальцем.

Превью всегда в мокапе (обложка на блокноте, а не просто картинка).

Состояния ожидания — “редакционные”: аккуратный прогресс, подсказки, “идёт сборка вариантов”.

Везде, где можно — «в один тап»: Докрутить, Поделиться, Заказать.

Share — ключ роста: кнопка “Поделиться” всегда на видном месте рядом с превью.

A1. Информационная архитектура (навигация)
Нижнее меню (tab bar) — 5 вкладок

Каталог (входные стили / редакция / дропы)

Создать (промпт + теги)

Поиск

Избранное

Профиль

На маленьких экранах допускается скрывать текст под иконками при прокрутке, но “Создать” должен быть всегда заметным.

Глобальные элементы

Toast/Снэкбар (низ): “Сохранено”, “Лимит исчерпан”, “Ошибка генерации”.

Bottom sheet для быстрых действий: “Докрутить”, “Ремикс”, “Сохранить”, “Поделиться”.

Скелетоны для карточек (стили, превью, популярное).

A2. Ключевые флоу (коротко)
Флоу 1 — “С нуля за 60 секунд”

Каталог стилей → лайки → Создать → Генерация → 3 превью → Докрутить/Выбрать → Наполнение → Тариф → Оплата → Заказ

Флоу 2 — “Увидел чужой дизайн → ремикснул”

Страница дизайна → Ремикс → Генерация (3 превью) → Докрутить → Заказ

Флоу 3 — “Лимит → безлимит на период”

Генерация → лимит → экран покупки → ЮKassa → вернулся → генерирует дальше

A3. Экраны (детальное описание)
Экран 0. Splash / Preload

Назначение: быстро показать бренд и прогрузить базовые данные (стили, категории тегов).

UI:

Лого FORMA

Текст маленький: “Редакция вкуса. Твой блокнот.”

Индикатор прогресса (ненавязчивый)

Состояния:

Loading (до 2–3 сек)

Fail → кнопка “Повторить” + “Открыть офлайн‑каталог” (если предусмотрите кеш)

Экран 1. Каталог (главная витрина)

Вкладка: Каталог

Секции (вертикальная лента):

“Выбери, что нравится” (кнопка “Начать”/“Продолжить”)

Редакция FORMA (горизонтальный скролл карточек)

Популярное сегодня

Дроп / Коллекция недели (если включено)

Категории стилей (минимализм, люкс, винтаж, техно, природа и т.д.)

Карточка дизайна в витрине:

Мокап превью

Название (короткое)

2–3 тега

Метки: “Популярное”, “Редакция”, “Drop” (маленькие)

Действия:

Тап по карточке → Страница дизайна (Экран 7)

Тап “Начать/Продолжить” → Онбординг вкуса (Экран 2)

Состояния:

Loading → скелетоны карточек

Empty → “Пока пусто. Начни с выбора стилей.”

Error → “Не удалось загрузить. Повторить”

Экран 2. Онбординг вкуса — “Выбери, что нравится”

Это ваш экран А-ключ №1 (как Tinder вкуса).

UI (вариант 1: свайп‑карточки):

Header: “Выбери 5 стилей — и мы соберём твой вкус”

Справа: “Пропустить”

По центру: одна большая карточка стиля

картинка

название

короткое описание (1 строка)

3–5 тегов (часть может быть “скрыта” — не показывать)

Внизу: кнопки

❌ “Не моё”

❤️ “Нравится”

✨ “Похожее” (опционально)

Прогресс:

“Выбрано: 0/5” (или точки‑индикатор)

После 5 лайков:

Bottom sheet: “Готово. Создадим блокнот в твоём стиле?”

CTA: “Создать”

вторичная: “Посмотреть ещё”

Состояния:

Loading следующей карточки — мгновенная подмена

NoMoreCards → предложить перейти в создание или обновить подборку

Микротексты:

“Не нравится” = “Пропустить”

“Нравится” = “Сохранить в вкус”

Экран 3. Создать (промпт + теги)

Вкладка: Создать

UI структура:

Заголовок: “Создай обложку”

Поле промпта (multiline):

Placeholder: “Например: минималистичный морской стиль, серебро вместо золота, спокойные формы…”

Под полем: “Подсказка: можно писать как просьбу дизайнеру”

Чипсы “Быстрые теги” (горизонтально):

Страна

Сезон

Стихия

Материал

Архитектура

“Brand mood” (отдельная категория)

Выбранные теги (чипсы с крестиком)

Блок “Основа стиля” (если пришёл из онбординга):

маленький текст: “Собрано из твоих предпочтений”

кнопка “Сменить стили” → Экран 2

Главный CTA (фиксирован снизу):

“Сгенерировать (Pro)”

подпись мелко: “Будет 3 варианта”

Состояния:

GuestLimitWarning (если гость близок к лимиту): “Осталось 1 генерация”

DisabledCTA если пустой промпт и нет тегов: кнопка неактивна + “Добавь описание или теги”

Экран 4. Генерация (прогресс)

Назначение: показать статус и не дать пользователю “отвалиться”.

UI:

Заголовок: “Собираем варианты”

Прогресс‑линия или шаги:

“Собираем стиль”

“Готовим 3 варианта”

“Делаем превью”

Текст-подсказка: “Варианты будут: основной + 2 мутации”

Доп. действия:

Кнопка “Отменить” (если поддерживается)

Блок “Пока ждёшь — посмотри популярное” (карточки)

Состояния:

Queued / Running

Timeout → “Дольше обычного. Мы продолжим, а ты можешь вернуться” + кнопка “В мои дизайны”

Failed → “Не получилось. Повторить” + “Изменить запрос”

Экран 5. Результат генерации — 3 превью (главный экран продукта)

Это ваш экран А-ключ №2.

UI:

Верх: “3 варианта”

Подзаголовок: “Основной + 2 идеи от редакции”

Горизонтальная лента из 3 карточек (пейджинг)

Карточка содержит:

мокап превью (крупно)

маленькая плашка:

“Основной”

“Мутация: заменили золото → серебро”

“Мутация: добавили tiffany mood”

кнопки на карточке:

“Выбрать” (primary)

“Докрутить” (secondary)

Ниже — панель быстрых действий (иконки):

❤️ Сохранить

↗ Поделиться

⎇ Ремикс

ⓘ Что изменили? (открывает лист с тегами/диффом)

Поведение “Выбрать”:

Нажал “Выбрать” на одной карточке → она становится “Текущий дизайн”

Внизу появляется CTA: “Продолжить → Наполнение”

Состояния:

ImageLoading внутри карточки → blur + спиннер

OneFailed → карточка с текстом “Этот вариант не получился” + “Пересобрать” (только для этой карточки)

AllFailed → экран ошибки как в Экран 4

Важно для бренда:

На превью может быть очень тонкий watermark FORMA (не раздражающий).

При “Поделиться” генерируется отдельная share‑картинка (см. Экран 6).

Экран 6. Поделиться (share sheet)

UI (bottom sheet):

Превью (мини)

Текст: “Поделиться дизайном”

Переключатель: “Показывать теги на картинке” (по умолчанию OFF, чтобы выглядело премиально)

Кнопки:

“Скопировать ссылку”

“Скачать изображение” (опционально)

Системный share (iOS/Android)

Что в ссылке:

Ведёт на публичную страницу дизайна (Экран 7)

Если дизайн приватный — спросить “Сделать публичным?” (переключатель)

Экран 6b. Докрутка (Refine)

UI:

Заголовок: “Докрутить”

Секция “Быстрые замены” (чипсы‑кнопки):

Металл: золото / серебро / хром / медь

Настроение: минимализм / люкс / винтаж / техно

Палитра: пастель / монохром / неон

Секция “Теги” по вкладкам:

Страны, Сезоны, Стихии, Архитектура, Мебель, Материалы, Brand mood

Поле “Скажи словами”:

Placeholder: “Например: сделай строже и меньше деталей”

Блок “Что сохраняем” (важно для стабильности стиля):

чекбокс: “Сохранить композицию (рекомендуем)” (по умолчанию ON)

CTA снизу: “Обновить (3 превью)”

Состояния:

TooManyTags → “Слишком много тегов. Оставь 5–12”

PolicyWarning для brand mood: “Только настроение бренда, без логотипов”

Экран 7. Страница дизайна (публичная)

URL‑страница, на которую ведёт QR / share.

UI:

Большое превью + галерея (если есть)

Название (авто или пользователь)

Плашки: “Редакция FORMA” / “Популярное” / “Drop”

Теги (только публичные)

Кнопки:

“Ремикснуть” (primary)

“Сделать похожий”

“Заказать”

Блок “Ремиксы” (горизонтально)

Блок “Похожие по вкусу”

Для бренда:

Секция “FORMA DNA” (мини):

“Собрано из: …”

“Создано: дата”

“ID: …”

(без показа скрытых тегов)

Экран 8. Наполнение (внутренний блок)

UI:

Заголовок: “Наполнение”

Список карточек:

Клетка (мини‑превью разворота)

Линейка

Точки

Пустые

Планер недельный (если в MVP)

При выборе — раскрываются параметры:

Нумерация страниц (toggle)

Язык (RU/EN)

(опционально) “Поля: узкие/стандарт”

CTA: “Дальше”

Состояния:

PDFPreviewLoading — если показываете превью разворота из PDF

Экран 9. Комплектация Base / Pro / Elite

UI:

Заголовок: “Комплектация”

Три карточки:

Base — 2599 ₽

Pro — 3199 ₽ (по умолчанию выделена)

Elite — 8999 ₽

У каждой — 3–5 буллетов отличий (редакционные формулировки, без технарщины)

CTA: “Оформить заказ”

Для Elite:

дополнительная плашка: “Коллекционный уровень”

(опционально) “Edition / Drop” если дизайн из дропа

Экран 10. Оформление заказа

UI:

Контакты:

имя

телефон

email

Доставка:

самовывоз / доставка (если есть)

адрес

комментарий

Итог:

комплектация

наполнение

цена

CTA: “Оплатить” (ЮKassa)

Состояния:

GuestCheckout → может требовать авторизацию перед оплатой:

“Войти, чтобы сохранить заказ” (VK/Яндекс/…)

Валидация:

телефон формат

обязательные поля

Экран 11. Оплата (ЮKassa)

Поведение:

Переход на форму YooKassa / виджет

После оплаты возврат на payment_return_url

Состояния:

Success → Экран 12

Cancel → вернуться в Экран 10 с сообщением “Платёж отменён”

Pending → экран “Проверяем оплату…”

Экран 12. Заказ принят

UI:

Заголовок: “Заказ принят”

Номер заказа

Статус: “Оплачен / Передан в производство”

Блок “FORMA DNA”:

QR на страницу дизайна

Кнопки:

“Отслеживать заказ”

“Сделать ещё один” (ведёт на Создать)

Экран 13. Поиск

Вкладка: Поиск

UI:

Поле поиска

Фильтры‑чипсы по категориям тегов

Результаты: дизайны / стили / промпты (вкладками)

Сортировка: популярное / новое / для вас

Экран 14. Избранное

Вкладка: Избранное

UI:

Вкладки: “Дизайны”, “Стили”

Карточки как в каталоге

Пустое состояние: “Сохраняй дизайны — соберём твою коллекцию”

Экран 15. Профиль

Вкладка: Профиль

UI:

Если не авторизован:

“Войти” (VK, Яндекс, T‑Bank, Альфа, Gmail)

маленький текст: “Вход сохранит твой вкус и историю”

Если авторизован:

“Мои дизайны”

“Мои заказы”

“Лимит генераций / Безлимит активен до …”

“Настройки”

“Поддержка”

Экран 16. Мои дизайны (история)

UI:

Список дизайнов:

превью‑мокап

дата

статус (черновик/публичный)

Быстрые действия:

“Докрутить”

“Заказать”

“Поделиться”

“Удалить/Скрыть”

Экран 17. Мои заказы

UI:

список заказов (карточки)

номер

дата

статус

сумма

тап → детали заказа:

штрихкод (как изображение)

состав

статусы

A4. Лимиты, paywall и покупки генераций (UI)
Экран L1. Лимит исчерпан

UI:

Заголовок: “Лимит генераций на сегодня исчерпан”

Варианты:

“Войти — получишь больше генераций”

“100 ₽ — безлимит на 24 часа”

CTA: “Включить безлимит за 100 ₽”

вторичная: “Войти”

третья: “Вернуться и отредактировать запрос”

Состояния:

успешная оплата → возвращаем на последний экран результата/докрутки

A5. Ошибки и крайние случаи (обязательно описать для разработки)

Ошибка одного превью: показать карточку‑заглушку “Не получилось” + “Пересобрать”

Ошибка всех трёх: экран ошибки + кнопки “Повторить” и “Изменить запрос”

Долгая генерация: “Мы продолжим, ты можешь уйти” + пуш/внутреннее уведомление (опционально)

Запрещённый запрос: “Мы не можем сделать это. Попробуй иначе.” + подсказки как переформулировать

Brand mood предупреждение: “Только настроение бренда, без логотипов”

A6. Микрокопи FORMA (тональность)

Формулировки должны звучать как редакция/ателье:

“Собираем варианты” (вместо “processing…”)

“Идея от редакции” (для мутаций)

“Докрутить” (ключевое слово)

“Сделать похожий”

“Вкус сохранён”

A7. Что дизайнер должен отдать в результате (deliverables)

Полный набор экранов (Figma):

Экран 1–17 + лимит/paywall

UI‑kit:

кнопки, чипсы тегов, карточки стилей, карточки превью, тарифные карточки

Компоненты состояний:

скелетоны, пустые состояния, ошибки

Шаблон share‑картинки

Шаблон “FORMA DNA Card” и “страница‑манифест” (как макеты)

Если ок — следующим шагом я могу сразу продолжить (в рамках Приложения A) и сделать “интерактивную карту переходов”: таблица “экран → действие → следующий экран” + список событий/аналитики (что трекать: share rate, conversion, повторные докрутки).

Давай карту переходов
Reasoned for 3m 57s

Ниже — карта переходов (navigation/transition map) FORMA в формате:

Экран → Действие/Событие → Следующий экран → Условия/Примечания

В конце — глобальные правила навигации и события аналитики (что трекать).

Карта переходов FORMA v0.1
Легенда

S0…S17 — экраны из Приложения A

L1 — paywall/лимит

Auth — модал/экран выбора провайдера входа + OAuth redirect flow

BS — bottom sheet (нижняя панель действий)

DeepLink — вход по ссылке/QR

1) Глобальные правила маршрутизации
   1.1. “Текущий дизайн” (Current Design Session)

В приложении всегда может существовать сущность CurrentDesign (черновик):

выбранный стиль (из вкуса)

промпт

выбранные теги

последний выбранный превью‑вариант

наполнение (если выбрано)

тариф (если выбран)

Правило: если пользователь уходит/возвращается — показываем “Продолжить” на S1 (Каталог) и/или в S15 (Профиль).

1.2. Назад (Back behavior)

Из S5 (3 превью) “Назад” ведёт в:

S6b (Докрутка), если пришли оттуда

иначе S3 (Создать)

Из S4 (Прогресс) “Назад”:

по умолчанию запрещён (чтобы не ломать ожидания), но можно “Отменить” → назад в S3

Из S11 (ЮKassa) — возврат управляется return_url:

успех → S12

отмена → S10

pending → S11p (внутренний “проверяем оплату”) → S12/S10

1.3. Гейт по лимитам генераций

Перед стартом генерации (из S3 или S6b) проверяем лимит:

если лимит ок → S4

если лимит исчерпан → L1

1.4. Гейт на оплату (гость/авторизация)

На S10 перед оплатой:

если пользователь гость, бизнес‑правило:

либо разрешаем оплату и создаём “гостевой заказ” (с email/телефоном)

либо требуем Auth (рекомендуется для сохранения истории и антифрода)

В карте ниже укажу как “вариант A/вариант B”.

2) Переходы по экранам
   S0 — Splash / Preload

App open → S0

Loaded OK → S1 (Каталог)

Load failed + “Повторить” → S0

Load failed + “Открыть офлайн/минимум” (если есть) → S1 (с ограниченным контентом)

S1 — Каталог (Главная витрина)

“Начать/Продолжить выбор вкуса” → S2

Тап по карточке дизайна (редакция/популярное/дроп) → S7

Тап по карточке стиля/категории → (опционально) S1a “Список стилей/подборка” или сразу S3 (с применённым стилем)

Нижняя навигация:

“Создать” → S3

“Поиск” → S13

“Избранное” → S14

“Профиль” → S15

“Продолжить последний дизайн” (если есть CurrentDesign) → S5 (если есть превью) или S3 (если только черновик без генерации)

S2 — Онбординг вкуса (“Выбери, что нравится”)

❤️ “Нравится” → остаёмся в S2, сохраняем preference, грузим следующую карточку

❌ “Не моё” → остаёмся в S2, грузим следующую

“Пропустить” → S3 (без профиля вкуса или с частичным)

Достигнут порог (например 5 лайков) → BS “Готово”:

“Создать” → S3 (с заполненным стилевым пресетом)

“Смотреть ещё” → S2

“Назад” → S1

S3 — Создать (промпт + теги)

“Сгенерировать (Pro)” → (проверка лимита):

лимит OK → S4

лимит исчерпан → L1

“Сменить стили” → S2

Добавить теги (чипсы) → остаёмся в S3

“Очистить” (если есть) → остаёмся в S3, сброс промпта/тегов

Нижняя навигация → S1/S13/S14/S15

S4 — Генерация (прогресс)

Generation succeeded (все 3 превью готовы) → S5

Partial success (1–2 превью готовы) → S5 (с заглушками на неготовые)

Failed → экран ошибки:

“Повторить” → S4 (новая попытка/повтор джобы)

“Изменить запрос” → S3

“Отменить” (если доступно) → отмена джоб → S3

Timeout/Long running → кнопка “В мои дизайны” → S16 (или S15→S16)

S5 — Результат генерации (3 превью)
Действия на карточке превью

“Выбрать” → помечаем превью как CurrentDesign.selected_preview → остаёмся на S5 + появляется CTA

“Докрутить” → S6b (Докрутка), при этом текущий вариант = выбранная карточка (или та, на которой нажали)

“Пересобрать этот вариант” (если одна карточка упала) → S4 (но в режиме single-variant retry) → обратно в S5

Глобальные действия

CTA “Продолжить → Наполнение” (после выбора) → S8

❤️ “Сохранить” → остаёмся S5 (если гость — сохраняем локально + предлагаем Auth мягко)

↗ “Поделиться” → S6

“Ремикс” → создаём fork → S6b (как старт докрутки ремикса) или остаёмся S5 с сообщением “Ремикс создан”

“Что изменили?” → BS (инфо) → остаёмся S5

“Назад” → S3 (или S6b если пришли из докрутки)

S6 — Поделиться (Share sheet / bottom sheet)

“Скопировать ссылку” → остаёмся S6 → закрыть → назад в S5

“Системный share” → после шаринга закрыть → назад в S5

Переключатель “сделать публичным”:

включили → дизайн получает public URL → остаёмся S6

“Закрыть” → S5

S6b — Докрутка (Refine)

CTA “Обновить (3 превью)” → (проверка лимита):

лимит OK → S4

лимит исчерпан → L1

Быстрые замены/теги/текст → остаёмся S6b

“Сбросить изменения” → остаёмся S6b (к исходному варианту)

“Назад” → S5 (без запуска новой генерации)

S7 — Публичная страница дизайна (Design page)
Входы

из S1 (витрина) → S7

из DeepLink/QR → S7

из S6 (share link) → S7

Действия

“Ремикснуть” → S6b (создаём fork, открываем докрутку)

“Сделать похожий” → S3 (переносим теги/стиль как пресет)

“Заказать” → если дизайн уже “готов к заказу”:

сразу S8

или (если нужно выбрать превью/вариант) → S5 с загруженным выбранным вариантом

❤️ “В избранное” → остаёмся S7 (если гость — локально)

“Пожаловаться” → BS “Причина” → остаёмся S7

S8 — Наполнение (внутренний блок)

Выбрать наполнение → остаёмся S8 (показываем параметры)

CTA “Дальше” → S9

“Назад” → S5

“Сохранить в черновик” (опционально) → остаёмся S8 / или S15

S9 — Комплектация Base / Pro / Elite

Выбор Base/Pro/Elite → остаёмся S9 (обновляем summary)

CTA “Оформить заказ” → S10

“Назад” → S8

S10 — Оформление заказа (контакты/доставка)

CTA “Оплатить” → Auth gate (если нужен):

Вариант A (разрешить гостя): сразу в S11 (ЮKassa)

Вариант B (требовать вход): → Auth, затем обратно в S10, затем S11

“Назад” → S9

“Сохранить как черновик” (опционально) → S15 → S16 (или просто toast и остаёмся S10)

S11 — Оплата (ЮKassa внешняя/встроенная)

Payment succeeded (return_url) → S12

Payment canceled → S10 + toast “Платёж отменён”

Payment pending → S11p “Проверяем оплату…” → (поллинг/вебхук) → S12 или S10

Payment failed → S10 + ошибка

S12 — Заказ принят

“Отслеживать заказ” → S17 (детали заказа) или S17a “Заказ #…”

“Сделать ещё один” → S3

“Поделиться дизайном” → S6 (если хотим)

“На главную” → S1

S13 — Поиск

Ввод запроса/выбор тегов → остаёмся S13 (обновляем результаты)

Тап по результату “дизайн” → S7

Тап по результату “стиль” → S3 (применить стиль как пресет) или S1a

Нижняя навигация → S1/S3/S14/S15

S14 — Избранное

Тап по дизайну → S7

“Ремикс” (из карточки) → S6b

Пустое состояние “Перейти в каталог” → S1

S15 — Профиль
Если гость

“Войти” → Auth → обратно в S15 (уже авторизован)

“Мои дизайны” → S16 (локальные/анонимные черновики)

“Мои заказы” → S17 (можно пусто до входа)

Если авторизован

“Мои дизайны” → S16

“Мои заказы” → S17

“Безлимит / пополнить” → (опционально) L1 (как магазин генераций)

“Выйти” → S15 (guest mode)

S16 — Мои дизайны (история)

Тап по дизайну → S5 (если есть 3 превью/варианты) или S7 (если публичный)

“Докрутить” → S6b

“Заказать” → S8 (если выбранный вариант/превью есть) иначе S5

“Поделиться” → S6

“Скрыть/Удалить” → остаёмся S16

“Назад” → S15

S17 — Мои заказы

Тап по заказу → S17a Детали заказа

“Назад” → S15

S17a — Детали заказа (подэкран)

Показ: статус, состав, штрихкод (визуально), трек‑номер (если есть)

“Поделиться дизайном” → S7 или S6

“Назад” → S17

L1 — Лимит исчерпан / Безлимит за 100 ₽

CTA “Включить безлимит за 100 ₽” → S11 (ЮKassa) (но как покупка генераций)

успех → возвращаем пользователя в точку старта, где он хотел генерировать:

если пришёл из S3 → обратно S3 + авто‑старт генерации (опционально) или кнопка “Сгенерировать”

если пришёл из S6b → обратно S6b + кнопка “Обновить”

отмена → назад в L1

“Войти (получить больше)” → Auth → обратно в L1, пересчитываем лимит:

если стало доступно → кнопка “Продолжить генерацию” → возврат в S3/S6b

“Назад” → возврат туда, откуда пришли (S3 или S6b)

Auth — Вход (модал/экран выбора провайдера)

Выбор провайдера (VK/Яндекс/T‑Bank/Альфа/Gmail) → OAuth redirect → return → экран‑источник

“Отмена” → назад на экран‑источник

Если Auth вызван из S10 (оплата) → возвращаем в S10

3) DeepLink/QR маршруты
   DL1 — Публичная ссылка на дизайн

/d/:slug или /designs/:id

Если дизайн существует и public → S7

Если приватный/нет доступа:

показать “Этот дизайн приватный” + “Сделать похожий” (если можно) → S3

или “Запросить доступ” (опционально, фаза 2)

DL2 — QR из DNA Card

Ведёт на ту же DL1 → S7

DL3 — Magic link на заказ (опционально)

/orders/:id

Если авторизован и владелец → S17a

Если гость и заказ гостевой (вариант A) → доступ по токену

4) События и аналитика (рекомендованный трекинг)

Чтобы FORMA рос как бренд, трекать нужно не “просмотры”, а цепочку “вкус → докрутка → шаринг → покупка”.

4.1. Вкус и каталог

catalog_open

style_like (style_id)

style_dislike

onboarding_complete (likes_count, time_spent)

catalog_design_open (design_id, source=editorial/popular/drop)

4.2. Создание и генерации

create_open

tag_add / tag_remove (tag_id, category)

prompt_edit (chars_count_delta)

generation_start (source=S3/S6b, is_guest, has_taste_profile)

generation_success (latency_ms, previews_ok=1..3)

generation_fail (error_type)

4.3. Работа с превью

preview_view (index=main/mutA/mutB)

preview_select (index)

preview_retry_single

refine_open

refine_apply_quick_swap (swap_type)

refine_submit (tags_count, text_delta)

4.4. Социальность и рост

share_open

share_make_public_toggle

share_complete (channel if available)

design_open_via_deeplink

4.5. Заказ и монетизация

filling_select (type)

plan_select (base/pro/elite)

checkout_start

payment_start (type=order/unlimited)

payment_success

payment_cancel

order_created

order_status_change_viewed (в профиле)

4.6. Лимиты

limit_hit (guest/auth)

unlimited_offer_view

unlimited_purchase_success

5) Быстрые “карты флоу” (для команды)
   Флоу “с нуля”

S1 → S2 → S3 → S4 → S5 → S8 → S9 → S10 → S11 → S12 → S17

Флоу “докрутка”

S5 → S6b → S4 → S5 (повторяем)

Флоу “ремикс из публичной страницы”

S7 → S6b → S4 → S5 → …

Флоу “лимит”

S3/S6b → L1 → S11 → (success) → назад в S3/S6b

Если хочешь, следующим шагом могу сделать “таблицу состояний” (state machine) для двух ключевых сущностей:

Generation (created → queued → running → partial → succeeded/failed/canceled)

Order/Payment (draft → awaiting_payment → paid → in_production → …)
Это сильно помогает разработке и тестированию.

Давай
список таблиц/полей (schema draft) под Rails migrations
Reasoned for 8m 55s

Ниже — schema draft (v0.1) для Rails migrations под FORMA (RoR + PostgreSQL). Это не “финальная” БД, а практичный каркас, который закрывает: каталог стилей, теги (public/hidden), ремиксы, 3 превью (main/mutA/mutB), заказы/ЮKassa/штрихкод, наполнения, админ‑курацию, дропы/edition и “безлимит за 100₽”.

Рекомендации по БД:

Деньги хранить как integer *_cents (в копейках), currency = "RUB".

Для публичных ссылок: slug + public_id (UUID).

Для файлов: использовать ActiveStorage (таблицы active_storage_blobs/attachments стандартные). В таблицах хранить метаданные, а сами файлы — attachments.

0) PostgreSQL extensions (один раз)

Миграции:

enable_extension "pgcrypto" (UUID)

enable_extension "citext" (email)

enable_extension "pg_trgm" (поиск/подсказки)

enable_extension "unaccent" (поиск)

1) Пользователи и авторизация
   1.1. users

Назначение: аккаунты, роли, лимиты, профиль.

Поля:

id: bigint

public_id: uuid, null: false, default: gen_random_uuid()

email: citext (nullable — при OAuth может не быть)

phone: string (nullable)

name: string

role: integer, null: false, default: 0
enum: 0=user, 10=moderator, 20=admin

status: integer, null: false, default: 0
enum: 0=active, 10=blocked, 20=deleted

locale: string, null: false, default: "ru"

timezone: string (optional)

last_seen_at: datetime

metadata: jsonb, null: false, default: {} (для будущего)

Индексы/уникальность:

index_users_on_public_id (unique)

index_users_on_email (unique, where email is not null)

index_users_on_phone (unique, where phone is not null)

index_users_on_role

1.2. oauth_identities

Назначение: привязки OAuth (VK, Яндекс, T‑Bank, Альфа, Gmail).

Поля:

id

user_id: bigint, null: false, foreign_key

provider: string, null: false (например: "vk", "yandex", "tbank", "alfa", "google")

uid: string, null: false

access_token: text (лучше шифровать rails encryption)

refresh_token: text

expires_at: datetime

scopes: string (nullable)

raw_profile: jsonb, null: false, default: {}

created_at, updated_at

Индексы:

index_oauth_identities_on_user_id

index_oauth_identities_on_provider_and_uid (unique)

1.3. anonymous_identities (для гостя/лимитов)

Назначение: учёт гостевых генераций без логина.

Поля:

id

anon_token_hash: string, null: false (хэш cookie token)

fingerprint_hash: string (nullable)

last_ip: inet (nullable)

last_seen_at: datetime

metadata: jsonb, default: {}

created_at, updated_at

Индексы:

index_anonymous_identities_on_anon_token_hash (unique)

index_anonymous_identities_on_fingerprint_hash

2) Теги (public/hidden), синонимы, правила совместимости
   2.1. tag_categories

Поля:

id

name: string, null: false (например “Страны”, “Сезоны”…)

slug: string, null: false

position: integer, null: false, default: 0

is_active: boolean, null: false, default: true

created_at, updated_at

Индексы:

index_tag_categories_on_slug (unique)

index_tag_categories_on_position

2.2. tags

Поля:

id

name: string, null: false

slug: string, null: false

tag_category_id: bigint, null: false, foreign_key

visibility: integer, null: false, default: 0
enum: 0=public, 10=hidden

kind: integer, null: false, default: 0
enum: 0=generic, 10=brand_mood

weight: decimal(6,3), null: false, default: 1.0 (для рекомендаций/мутаций)

is_banned: boolean, null: false, default: false

banned_reason: string

metadata: jsonb, null: false, default: {}

created_at, updated_at

Индексы:

index_tags_on_slug (unique)

index_tags_on_tag_category_id

index_tags_on_visibility

index_tags_on_kind

index_tags_on_is_banned

index_tags_on_name (gin_trgm) (для автодополнения)

2.3. tag_synonyms

Поля:

id

tag_id: bigint, null: false

phrase: string, null: false (синоним/вариант написания)

normalized: string, null: false (для поиска)

created_at, updated_at

Индексы:

index_tag_synonyms_on_tag_id

index_tag_synonyms_on_normalized (unique)

2.4. tag_relations (иерархия + совместимость)

Один стол на всё, тип связи через enum.

Поля:

id

from_tag_id: bigint, null: false

to_tag_id: bigint, null: false

relation_type: integer, null: false
enum: 0=parent_of, 10=related, 20=conflicts_with, 30=discouraged_with

weight: decimal(6,3), default: 1.0

created_at, updated_at

Индексы:

index_tag_relations_on_from_tag_id

index_tag_relations_on_to_tag_id

index_tag_relations_on_relation_type

index_tag_relations_on_from_to_type (unique) (составной)

3) Каталог стилей и витрины
   3.1. styles

Поля:

id

name: string, null: false

slug: string, null: false

description: text

status: integer, null: false, default: 0
enum: 0=draft, 10=published, 20=hidden

position: integer, null: false, default: 0

popularity_score: decimal(10,4), null: false, default: 0

generation_preset: jsonb, null: false, default: {} (настройки провайдера/модели/параметров)

created_at, updated_at

Индексы:

index_styles_on_slug (unique)

index_styles_on_status

index_styles_on_position

index_styles_on_popularity_score

ActiveStorage attachments (рекомендовано):

styles.cover_image (основная картинка)

styles.gallery_images[] (опционально)

3.2. style_tags (M2M)

Поля:

id

style_id: bigint, null: false

tag_id: bigint, null: false

is_primary: boolean, default: false

created_at, updated_at

Индексы:

index_style_tags_on_style_id

index_style_tags_on_tag_id

index_style_tags_on_style_id_and_tag_id (unique)

3.3. catalog_sections (витрины: “Редакция”, “Популярное”, “Дроп”)

Поля:

id

name: string, null: false

slug: string, null: false

section_type: integer, null: false, default: 0
enum: 0=editorial, 10=popular, 20=new, 30=drop, 40=custom

is_active: boolean, null: false, default: true

position: integer, default: 0

rules: jsonb, default: {} (например “rating>=4”)

created_at, updated_at

Индексы:

index_catalog_sections_on_slug (unique)

index_catalog_sections_on_section_type

index_catalog_sections_on_position

3.4. catalog_items (что показывать в витрине)

Поля:

id

catalog_section_id: bigint, null: false

item_type: string, null: false (polymorphic: "Style", "Design", "Drop")

item_id: bigint, null: false

position: integer, default: 0

pinned: boolean, default: false

created_at, updated_at

Индексы:

index_catalog_items_on_catalog_section_id

index_catalog_items_on_item_type_and_item_id

index_catalog_items_on_catalog_section_and_position

4) Дизайны, промпты, ремиксы, публикация
   4.1. designs

Назначение: “дизайн блокнота” как сущность, которой делятся, ремиксят и заказывают.

Поля:

id

public_id: uuid, null: false, default: gen_random_uuid()

user_id: bigint (nullable — если дизайн системный/админский)

source_design_id: bigint (nullable) — родитель для ремикса

title: string (nullable, авто)

slug: string (nullable, уникально когда public)

visibility: integer, null: false, default: 0
enum: 0=private, 10=unlisted, 20=public

moderation_status: integer, null: false, default: 0
enum: 0=ok, 10=requires_review, 20=blocked

style_id: bigint (nullable)

base_prompt: text (последний “человекочитаемый” промпт)

metadata: jsonb, default: {}

popularity_score: decimal(10,4), default: 0

created_at, updated_at

Индексы:

index_designs_on_public_id (unique)

index_designs_on_user_id

index_designs_on_source_design_id

index_designs_on_style_id

index_designs_on_visibility

index_designs_on_popularity_score

index_designs_on_slug (unique, where slug is not null)

ActiveStorage attachments (опционально):

designs.hero_image (если фиксируете лучший вариант)

designs.share_image

4.2. design_tags (M2M, снапшот тегов дизайна)

Поля:

id

design_id: bigint, null: false

tag_id: bigint, null: false

source: integer, null: false, default: 0
enum: 0=user, 10=system, 20=admin, 30=autotag

created_at, updated_at

Индексы:

index_design_tags_on_design_id

index_design_tags_on_tag_id

index_design_tags_on_design_id_and_tag_id (unique)

4.3. prompts (если хотите хранить как отдельную сущность)

Если достаточно designs.base_prompt, можно не делать. Но для ремиксов/истории — полезно.

Поля:

id

design_id: bigint, null: false

current_text: text, null: false

created_at, updated_at

Индексы:

index_prompts_on_design_id

4.4. prompt_versions (история изменений)

Поля:

id

prompt_id: bigint, null: false

text: text, null: false

changed_by_user_id: bigint (nullable, если системная правка)

change_reason: string (например “refine”, “mutation”)

diff_summary: string (коротко: “gold→silver”)

metadata: jsonb, default: {}

created_at

Индексы:

index_prompt_versions_on_prompt_id

index_prompt_versions_on_changed_by_user_id

5) Генерации: 3 варианта (main/mutA/mutB), статусы, ассеты
   5.1. generations

Один “запуск” кнопки Сгенерировать. Внутри 3 варианта.

Поля:

id

design_id: bigint, null: false

user_id: bigint (nullable)

anonymous_identity_id: bigint (nullable)

source: integer, null: false, default: 0
enum: 0=create, 10=refine, 20=remix, 30=admin_batch

status: integer, null: false, default: 0
enum: 0=created, 10=queued, 20=running, 30=partial, 40=succeeded, 50=failed, 60=canceled

provider: string, null: false (какой провайдер генерации)

preset_snapshot: jsonb, default: {} (какой style preset применили)

tags_snapshot: jsonb, default: {} (какие теги были на входе)

error_code: string

error_message: text

started_at: datetime

finished_at: datetime

created_at, updated_at

Индексы:

index_generations_on_design_id

index_generations_on_user_id

index_generations_on_anonymous_identity_id

index_generations_on_status

index_generations_on_created_at

5.2. generation_variants

3 записи на 1 generation. (main, mutA, mutB)

Поля:

id

generation_id: bigint, null: false

kind: integer, null: false
enum: 0=main, 10=mutation_a, 20=mutation_b

status: integer, null: false, default: 0
enum: 0=created, 10=queued, 20=running, 30=succeeded, 40=failed

composed_prompt: text, null: false (финальный промпт после сборки)

seed: bigint (nullable)

mutation_summary: string (“gold→silver”, “added tiffany mood”)

mutation_tags_added: jsonb, default: []

mutation_tags_removed: jsonb, default: []

provider_job_id: string (id задачи у провайдера)

provider_metadata: jsonb, default: {}

error_code: string

error_message: text

created_at, updated_at

Индексы:

index_generation_variants_on_generation_id

index_generation_variants_on_kind (и уникальность kind в рамках generation)

index_generation_variants_on_generation_id_and_kind (unique)

index_generation_variants_on_provider_job_id

ActiveStorage attachments (рекомендовано):

variant.preview_image (картинка)

variant.mockup_image (мокап блокнота)

variant.hires_image (hires для печати/макета)

5.3. generation_selections

Какие варианты выбрали пользователи. Важно для “популярного” и обучения вкуса.

Поля:

id

generation_id: bigint, null: false

generation_variant_id: bigint, null: false

user_id: bigint (nullable)

anonymous_identity_id: bigint (nullable)

created_at

Индексы:

index_generation_selections_on_generation_id

index_generation_selections_on_generation_variant_id

(опционально) уникальность “один выбор на generation на пользователя”

5.4. design_ratings

Оценки 1–5 (включая админ‑курацию).

Поля:

id

design_id: bigint, null: false

user_id: bigint (nullable — если админская оценка можно тоже через user_id)

source: integer, null: false, default: 0
enum: 0=user, 10=admin

score: integer, null: false (1..5)

comment: string (nullable)

created_at, updated_at

Индексы:

index_design_ratings_on_design_id

index_design_ratings_on_user_id

index_design_ratings_on_design_id_and_user_id (unique, where source=0) (пользовательская оценка одна)

5.5. favorites

Поля:

id

user_id: bigint, null: false

design_id: bigint, null: false

created_at

Индексы:

index_favorites_on_user_id

index_favorites_on_design_id

index_favorites_on_user_id_and_design_id (unique)

5.6. moderation_reports (жалобы)

Поля:

id

reporter_user_id: bigint (nullable)

design_id: bigint, null: false

reason: integer, null: false (enum)

details: text

status: integer, default: 0 (open/closed)

created_at, updated_at

Индексы:

index_moderation_reports_on_design_id

index_moderation_reports_on_status

6) Наполнения (внутренние блоки) и печатные шаблоны
   6.1. fillings

Поля:

id

name: string, null: false (Клетка/Линейка/Точки/Планер)

slug: string, null: false

filling_type: integer, null: false
enum: 0=grid, 10=ruled, 20=dot, 30=blank, 40=planner_weekly, 50=planner_daily, 60=dated

is_active: boolean, default: true

default_settings: jsonb, default: {} (поля, нумерация, язык, размеры)

created_at, updated_at

Индексы:

index_fillings_on_slug (unique)

index_fillings_on_filling_type

index_fillings_on_is_active

ActiveStorage attachments:

fillings.preview_spread_image (мини‑превью разворота)

6.2. filling_templates (если нужен генератор PDF на основе шаблонов)

Поля:

id

filling_id: bigint, null: false

name: string (например “A5 Ru default”)

format: string (“A5”, “B5”…)

settings_schema: jsonb, default: {} (какие настройки доступны)

renderer: string (“prawn”, “render_pdf_service”, etc.)

is_active: boolean, default: true

created_at, updated_at

Индексы:

index_filling_templates_on_filling_id

index_filling_templates_on_is_active

7) SKU (Base/Pro/Elite), физические параметры, “продуктовый код”
   7.1. notebook_skus

Поля:

id

code: string, null: false (“base”, “pro”, “elite”)

name: string, null: false (“FORMA Base”…)

price_cents: integer, null: false

currency: string, null: false, default: "RUB"

is_active: boolean, default: true

specs: jsonb, default: {} (обложка/материал/финиш/упаковка/резинка/карман/тиснение и т.п.)

brand_elements: jsonb, default: {} (DNA Card включена? манифест? edition?)

created_at, updated_at

Индексы:

index_notebook_skus_on_code (unique)

index_notebook_skus_on_is_active

8) Заказы, оплата (ЮKassa), штрихкоды, файлы производства
   8.1. orders

Поля:

id

public_id: uuid, null: false, default: gen_random_uuid()

order_number: string, null: false (человекочитаемый, например FORMA-2026-000123)

user_id: bigint (nullable если гостевой)

anonymous_identity_id: bigint (nullable)

status: integer, null: false, default: 0
enum: 0=draft, 10=awaiting_payment, 20=paid, 30=in_production, 40=shipped, 50=delivered, 60=canceled, 70=refunded

subtotal_cents: integer, null: false, default: 0

shipping_cents: integer, null: false, default: 0

total_cents: integer, null: false, default: 0

currency: string, null: false, default: "RUB"

Контакты/доставка:

customer_name: string

customer_phone: string

customer_email: citext

shipping_method: string (nullable)

shipping_address: jsonb, default: {} (адрес структурно)

tracking_number: string (nullable)

notes: text (nullable)

Производство:

barcode_value: string, null: false

barcode_type: string, null: false, default: "code128"

production_notes: text (nullable)

Ссылки:

created_at, updated_at

Индексы:

index_orders_on_public_id (unique)

index_orders_on_order_number (unique)

index_orders_on_user_id

index_orders_on_status

index_orders_on_created_at

index_orders_on_barcode_value (unique)

8.2. order_items

Даже если сейчас 1 блокнот — лучше сразу так.

Поля:

id

order_id: bigint, null: false

design_id: bigint, null: false

notebook_sku_id: bigint, null: false

filling_id: bigint, null: false

quantity: integer, null: false, default: 1

unit_price_cents: integer, null: false

total_price_cents: integer, null: false

format: string (“A5”, …) (если применимо)

settings_snapshot: jsonb, default: {} (настройки наполнения/параметры печати)

created_at, updated_at

Индексы:

index_order_items_on_order_id

index_order_items_on_design_id

index_order_items_on_notebook_sku_id

8.3. payments (ЮKassa)

Лучше через polymorphic payable, чтобы одной таблицей покрыть и заказ, и “безлимит”.

Поля:

id

payable_type: string, null: false (“Order” / “GenerationPass”)

payable_id: bigint, null: false

provider: string, null: false, default: "yookassa"

provider_payment_id: string (id в YooKassa)

status: integer, null: false, default: 0
enum: 0=created, 10=pending, 20=succeeded, 30=canceled, 40=failed, 50=refunded

amount_cents: integer, null: false

currency: string, null: false, default: "RUB"

idempotence_key: string (если используете)

confirmation_url: text (nullable)

captured_at: datetime (nullable)

raw: jsonb, default: {} (весь payload для аудита)

created_at, updated_at

Индексы:

index_payments_on_payable_type_and_payable_id

index_payments_on_provider_payment_id (unique, where provider_payment_id is not null)

index_payments_on_status

index_payments_on_created_at

8.4. order_files (файлы производства)

Метаданные + ActiveStorage.

Поля:

id

order_id: bigint, null: false

file_type: integer, null: false
enum: 0=cover_print_pdf, 10=inner_print_pdf, 20=dna_card_pdf, 30=packing_slip_pdf, 40=preview_pack_zip

status: integer, default: 0 (created/rendering/ready/failed)

metadata: jsonb, default: {}

created_at, updated_at

Индексы:

index_order_files_on_order_id

index_order_files_on_file_type

ActiveStorage attachment:

order_files.file

9) “Безлимит за 100₽” / лимиты / квоты
   9.1. generation_passes

Сущность “безлимит на период”.

Поля:

id

user_id: bigint (nullable если купил гость — но лучше требовать auth)

status: integer, null: false, default: 0
enum: 0=active, 10=expired, 20=canceled

starts_at: datetime, null: false

ends_at: datetime, null: false

price_cents: integer, null: false, default: 10000 (100₽ = 10000 коп.)

currency: string, default: "RUB"

fair_use: jsonb, default: {} (rate limits, parallel limits)

created_at, updated_at

Индексы:

index_generation_passes_on_user_id

index_generation_passes_on_status

index_generation_passes_on_ends_at

payments.payable может ссылаться на GenerationPass.

9.2. usage_counters (опционально, если не хотите считать по логам)

Поля:

id

user_id: bigint (nullable)

anonymous_identity_id: bigint (nullable)

period: date, null: false (или datetime bucket)

generations_count: integer, default: 0

created_at, updated_at

Индексы:

index_usage_counters_on_period

index_usage_counters_on_user_id_and_period (unique, where user_id is not null)

index_usage_counters_on_anonymous_identity_id_and_period (unique, where anonymous_identity_id is not null)

10) Дропы / коллекции / edition numbering (брендовый слой)
    10.1. drops

Поля:

id

name: string, null: false

slug: string, null: false

status: integer, default: 0 (draft/published/closed)

starts_at: datetime

ends_at: datetime

edition_limit: integer (например 300)

created_at, updated_at

Индексы:

index_drops_on_slug (unique)

index_drops_on_status

10.2. drop_items

Поля:

id

drop_id: bigint, null: false

design_id: bigint, null: false

position: integer, default: 0

is_active: boolean, default: true

created_at, updated_at

Индексы:

index_drop_items_on_drop_id

index_drop_items_on_design_id

index_drop_items_on_drop_id_and_design_id (unique)

10.3. edition_assignments

Конкретная нумерация для Elite/дропа. Можно привязывать к order_item (когда купили).

Поля:

id

drop_id: bigint

design_id: bigint, null: false

order_item_id: bigint (nullable до продажи)

edition_number: integer, null: false (43)

edition_total: integer (300)

status: integer, default: 0 (reserved/assigned/canceled)

created_at, updated_at

Индексы:

index_edition_assignments_on_design_id

index_edition_assignments_on_order_item_id

index_edition_assignments_on_drop_id_and_edition_number (unique)

11) Вкус пользователя (лайки стилей) и персонализация
    11.1. style_votes

Поля:

id

user_id: bigint (nullable — можно и для гостя через anonymous_identity_id)

anonymous_identity_id: bigint (nullable)

style_id: bigint, null: false

value: integer, null: false (+1 like, -1 dislike)

created_at

Индексы:

index_style_votes_on_style_id

index_style_votes_on_user_id

index_style_votes_on_anonymous_identity_id

index_style_votes_on_style_id_and_user_id (unique, where user_id is not null)

index_style_votes_on_style_id_and_anonymous_identity_id (unique, where anonymous_identity_id is not null)

11.2. user_tag_affinities (опционально)

Если хотите хранить веса по тегам, а не вычислять на лету.

Поля:

id

user_id: bigint, null: false

tag_id: bigint, null: false

weight: decimal(8,4), null: false, default: 0

updated_at

Индексы:

index_user_tag_affinities_on_user_id

index_user_tag_affinities_on_tag_id

index_user_tag_affinities_on_user_id_and_tag_id (unique)

12) Админ‑аудит, настройки
    12.1. audit_logs

Поля:

id

actor_user_id: bigint, null: false (админ/модератор)

action: string, null: false (например "tag.create", "style.publish")

record_type: string

record_id: bigint

before: jsonb, default: {}

after: jsonb, default: {}

ip: inet

created_at

Индексы:

index_audit_logs_on_actor_user_id

index_audit_logs_on_record_type_and_record_id

index_audit_logs_on_action

index_audit_logs_on_created_at

12.2. app_settings (key-value)

Поля:

id

key: string, null: false

value: jsonb, null: false, default: {}

updated_by_user_id: bigint

updated_at

Индексы:

index_app_settings_on_key (unique)

13) Поиск (опционально, но рекомендую заложить сразу)
    Вариант A (простой): PostgreSQL full-text на designs

Добавить в designs:

search_vector: tsvector (generated/triggered)
Индекс:

index_designs_on_search_vector (GIN)

Содержимое: title + base_prompt + публичные теги + style.name

Вариант B: отдельная таблица search_documents

Если хотите индексировать и стили, и дизайны одним механизмом.

14) ActiveStorage (обязательно, стандарт Rails)

Rails создаст:

active_storage_blobs

active_storage_attachments

(опционально) active_storage_variant_records

15) Минимально необходимый набор для MVP

Если нужно “урезать” до MVP без боли, оставляем обязательно:

users, oauth_identities, anonymous_identities

tag_categories, tags, tag_synonyms, tag_relations (можно relation позже)

styles, style_tags

designs, design_tags

generations, generation_variants, generation_selections

fillings (+ возможно без filling_templates на старте)

notebook_skus

orders, order_items, payments, order_files

generation_passes

audit_logs, app_settings

Drops/editions можно оставить миграциями “на будущее”, но не включать в UI сразу.

Если хочешь, следующим сообщением сделаю state machine (таблично) для:

Generation и GenerationVariant (включая partial success)

Order и Payment (включая вебхуки ЮKassa и идемпотентность)

— это прямой мост от схемы к бизнес‑логике и тестам.