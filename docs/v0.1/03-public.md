# 03. Публичная часть — FORMA

> Версия: v0.1 | Дата: 2026-02-14

## 1. Каталог стилей (входной)

### 1.1. Назначение

Максимально быстро "вытянуть" вкус пользователя и направить его в создание блокнота.

### 1.2. Карточка стиля

| Поле | Описание |
|------|----------|
| Изображение-пример | Мокап обложки на блокноте |
| Название | Короткое, "редакционное" |
| Описание | 1 строка |
| Теги | 3-6 штук (часть может быть скрыта) |
| Пресет генерации | Параметры модели/шаблона (не показывается) |
| Популярность/рейтинг | Если есть |

### 1.3. Механика "Выбери, что нравится"

- Минимум 12 карточек на старт
- После 5 лайков — предложение "создать"
- Профиль предпочтений сохраняется (user_preferences / style_votes)
- На телефоне: свайп или сетка + быстрый лайк

### 1.4. Витрины каталога

| Витрина | Описание | Правила |
|---------|----------|---------|
| Редакция FORMA | Отобранные админом | admin_rating >= 4 |
| Популярное сегодня | По метрикам | просмотры + заказы + оценки |
| Новые | Хронологические | последние N дней |
| Дроп / Коллекция | Лимитированные | привязка к Drop |
| Категории | По стилям | минимализм, люкс, винтаж, техно... |

## 2. Поиск

### 2.1. Виды поиска

| Тип | Описание | Реализация |
|-----|----------|-----------|
| По словам (full-text) | Текстовый поиск | PostgreSQL tsvector + trigram |
| По тегам (faceted) | Фильтрация чипсами | JOIN по design_tags |
| По похожести промптов | Семантический (фаза 2) | Векторный поиск |

### 2.2. Автодополнение

- Trigram-индекс на `tags.name`
- Подсказки тегов при вводе
- Быстрый отклик (< 200 мс)

### 2.3. Фильтры

- Стиль
- Категории тегов
- Тариф (если применимо)
- Популярное / Новое

### 2.4. Сортировки

- Популярность
- Рейтинг
- Новизна
- "Похоже на мой вкус" (по профилю предпочтений)

## 3. Популярное

### 3.1. Контент

- Топ дизайнов
- Топ промптов
- Топ ремиксов

### 3.2. Метрики для ранжирования

| Метрика | Вес (настраиваемо) |
|---------|-------------------|
| Просмотры | Базовый |
| Выбор/покупки | Высокий |
| Оценки (1-5) | Средний |
| Сохранения (избранное) | Средний |
| Шаринг | Высокий |

### 3.3. popularity_score

Вычисляемое поле на `designs.popularity_score`:
- Обновляется периодически (Sidekiq job)
- Формула настраивается через `app_settings`

## 4. Ремиксы

### 4.1. Механика

- Любой **публичный** дизайн/промпт можно "взять и докрутить"
- Создается fork (новый `design` с `source_design_id`)
- Сохраняется родословная

### 4.2. На странице дизайна

- Блок "Ремиксы" — горизонтальная лента форков
- "Создан из: [ссылка на исходник]"

### 4.3. Данные

```
designs.source_design_id -> родительский дизайн
prompt_versions.change_reason = "remix"
prompt_versions.diff_summary = "forked from ..."
```

## 5. Шаринг

### 5.1. Требования (обязательно для роста бренда)

- **Share-картинка:** превью + название дизайна + маленький знак FORMA
- **Короткий URL:** на публичную страницу дизайна
- **Share в 1 тап:** iOS/Android системный шаринг
- **Watermark:** минимальный, не портит превью

### 5.2. Публичная страница дизайна (S7)

URL: `/d/:slug` или `/designs/:hashid` (6 символов)

Содержимое:
- Большое превью + галерея
- Название, теги (только публичные)
- Кнопки: "Ремикснуть", "Сделать похожий", "Заказать"
- FORMA DNA: "Собрано из: ...", дата, ID
- Блок "Ремиксы", "Похожие по вкусу"

### 5.3. OG/meta-теги

Для красивого превью в мессенджерах/соцсетях:
- `og:title` — название дизайна
- `og:image` — share-картинка
- `og:description` — теги + "Создай свой на FORMA"

## 6. Система тегов (публичная часть)

### 6.1. Типы тегов

| Тип | Показывается пользователю |
|-----|--------------------------|
| public | Да — как чипсы/фильтры |
| hidden | Нет — только для системы |

### 6.2. Категории тегов

| Категория | Примеры |
|-----------|---------|
| География | Все страны мира (+ города опционально) |
| Времена года | Весна, лето, осень, зима |
| Стихии | Огонь, вода, земля, воздух |
| Бренды одежды* | "Brand mood" — вдохновение, без логотипов |
| IT/соцсети* | "Brand mood" |
| Бренды lifestyle* | ikea mood, starbucks mood |
| Стили мебели | Модерн, ар-деко, скандинавский... |
| Архитектура | Барокко, минимализм, хай-тек... |
| Палитры/материалы | Золото, серебро, хром, пастель, неон... |
| Типографика/настроение | Строго, люкс, минимализм, барокко, киберпанк |

*Brand mood — вдохновение, без логотипов и копирования.

### 6.3. Скрытые теги в выдаче

- По умолчанию не показываются
- Можно показывать "объяснение" мутаций: "Мы добавили: ..."
- Показывать только безопасные/публичные аналоги

## 7. Наполнения (выбор пользователем)

### 7.1. Минимальный список (MVP)

| Тип | Slug | Описание |
|-----|------|----------|
| Клетка | `grid` | Стандартная клетка |
| Линейка | `ruled` | Линованные страницы |
| Точки | `dot` | Dot grid |
| Пустые | `blank` | Чистые страницы |
| Планер недельный | `planner_weekly` | Недатированный (если в MVP) |
| Ежедневник | `planner_daily` | Недатированный (если в MVP) |

### 7.2. Параметры при выборе

- Формат (A5 / B5 — задается бизнесом)
- Нумерация страниц (да/нет)
- Язык/локаль (ru по умолчанию)
- Поля (узкие/стандарт) — опционально

### 7.3. Генерация PDF

Каждое наполнение генерирует print-ready PDF внутреннего блока.
