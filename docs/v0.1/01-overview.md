# 01. Общее описание — FORMA

> Версия: v0.1 | Дата: 2026-02-14

## 1. Название и суть

**FORMA** — сервис, где пользователь быстро выбирает вкус через каталог стилей, генерирует дизайн обложки блокнота, докручивает его через теги/промпт (в стиле "золото -> серебро -> tiffany mood"), получает 3 коротких превью на каждый шаг (1 основной + 2 "мутации"), а затем заказывает блокнот в комплектациях Base / Pro / Elite с оплатой через ЮKassa.

## 2. Цель продукта

Пользователь:
1. Выбирает стиль (быстро, "на входе")
2. Задает промпт / теги / слова
3. Получает 3 коротких превью (основное + 2 мутации с подкинутыми тегами)
4. Докручивает результат (как "золото -> серебро -> tiffany")
5. Выбирает комплектацию и тариф (Base / Pro / Elite)
6. Оплачивает через ЮKassa и оформляет заказ
7. Заказ маркируется штрихкодом и уходит в производство

## 3. Технологический стек

| Компонент | Технология |
|-----------|-----------|
| Backend | Ruby on Rails |
| DB | PostgreSQL |
| Очереди/джобы | Sidekiq + Redis |
| Хранилище файлов | S3-compatible (Yandex Object Storage / MinIO / AWS S3) |
| Оплата | ЮKassa (webhooks) |
| Аутентификация | OAuth (VK, Яндекс, T-Bank, Альфа, Gmail) |
| Генерация | Абстракция провайдеров (сменяемый) |

## 4. Формат интерфейса

- **Mobile-first** (основной сценарий — телефон)
- Desktop — адаптивный (не отдельное приложение)

## 5. Термины и сущности

| Термин | Определение |
|--------|------------|
| Промпт | Текстовое описание обложки/стиля |
| Тег | Элемент управляемого словаря (страна, сезон, стихия, бренд, архитектурный стиль...) |
| Скрытые теги | Теги для системы (поиск/мутации/аналитика), не показываются пользователю |
| Стиль | Карточка стиля в каталоге (пример + набор тегов + пресет генерации) |
| Генерация | Запуск пайплайна создания дизайна (превью/варианты) |
| Превью | Быстрый результат (картинка + мокап + описание) |
| Вариант | Одно из предложений по дизайну (включая "мутации") |
| Ремикс | Создание нового дизайна на базе чужого (fork) с сохранением происхождения |
| Наполнение | Тип внутреннего блока (клетка/линейка/точки/планер/датированный...) |
| Тариф | Base / Pro / Elite (разные цены, опции, материалы) |
| Кредиты генераций | Лимиты/баланс/покупка доступа |
| Мутация | Автоматическая модификация дизайна подбросом 1-2 тегов |
| Design DNA Card | Карточка происхождения дизайна (в блокноте) |
| Дроп | Лимитированная коллекция отобранных дизайнов |

## 6. Роли и права доступа

### 6.1. Роли

| Роль | Описание |
|------|----------|
| Гость | Просмотр каталога, ограниченные генерации, шаринг превью |
| Пользователь | Генерации, докрутка, ремиксы, сохранения, заказ/оплата, история |
| Создатель (фаза 2) | Публикация промптов/стилей в каталог (через модерацию) |
| Модератор | Очереди модерации, блокировки |
| Админ | Теги, стили, каталог, дропы, генерации, заказы, оплаты, лимиты |

### 6.2. Enum ролей (string)

```ruby
# user.role
"user"       # обычный пользователь
"creator"    # создатель (фаза 2)
"moderator"  # модератор
"admin"      # администратор
```

## 7. Бренд FORMA

### 7.1. Ключевая идея

FORMA — не "печать кастома", а **редакция вкуса + ритуал + коллекционирование**:

- **Редакция:** каталог стилей, скрытые теги, курация результатов (админ-оценки 1-5)
- **Ритуал:** удобство ежедневного использования (наполнения, качество бумаги)
- **Коллекция:** Edition, Drops, DNA Card, QR-история, ремиксы

### 7.2. Продуктовый код FORMA

В каждом блокноте (минимум Pro/Elite):
1. **FORMA DNA Card** — карточка происхождения дизайна (в кармане/вклейке)
2. **Страница-манифест** — "Designed by you. Curated by FORMA."
3. **Фирменная метка** — на корешке/внутри
4. **QR-код** — на страницу дизайна (просмотр, ремиксы, "создать похожий")
5. **Edition numbering** (Elite) — например 043/300

### 7.3. Комплектации

| Тариф | Цена | Описание |
|-------|------|----------|
| FORMA Base | 2 599 ₽ | "Everyday" — мягкая обложка, стандартная бумага |
| FORMA Pro | 3 199 ₽ | "Signature" — тактильная обложка, DNA Card, улучшенная бумага |
| FORMA Elite | 8 999 ₽ | "Collector/Atelier" — твердая обложка, тиснение, коробка, Edition |

### 7.4. Тон бренда

- Редакционный, не технологичный
- Спокойный, умный
- Короткие формулировки
- Ощущение вкуса и статуса без пафоса

## 8. Нефункциональные требования

### 8.1. Производительность
- Каталог и поиск: < 500 мс
- Превью: прогрессивная загрузка (thumb -> medium)
- Генерации: асинхронные (очередь Sidekiq)

### 8.2. Надежность
- Повторяемость джоб при сбое (retry)
- Идемпотентные webhooks оплаты
- Логи по генерациям и оплатам

### 8.3. Безопасность
- OAuth через проверенные стратегии
- Rate limit на генерации
- Хранение персональных данных с учетом требований РФ

## 9. Критерии приемки (MVP)

MVP принят, если:
- [ ] Есть входной каталог стилей + лайки -> влияет на предложения
- [ ] Есть создание промпта + теги
- [ ] Каждая генерация возвращает 3 превью: основное + 2 мутации с объяснением
- [ ] Есть докрутка и повторные итерации
- [ ] Есть поиск по словам и тегам
- [ ] Есть "Популярное"
- [ ] Есть ремиксы (fork)
- [ ] Есть наполнения (минимум 4) + PDF внутреннего блока
- [ ] Есть Base/Pro/Elite, по умолчанию Pro
- [ ] Есть заказ + ЮKassa + webhooks + штрихкод
- [ ] Есть админка: теги/стили/каталог, кураторский режим, заказы
